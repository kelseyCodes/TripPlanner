!function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){module.exports=angular.module("grid",[require("./angular-decorator").name,require("./angular-builder").name]).factory("GridSrvc",function(){return{core:require("./core")}})},{"./angular-builder":13,"./angular-decorator":14,"./core":22}],2:[function(require,module,exports){module.exports=function(string){return string.charAt(0).toUpperCase()+string.substring(1)},module.exports.words=function(string){return string.replace(/(^|\W)(\w)/g,function(m){return m.toUpperCase()})}},{}],3:[function(require,module,exports){function ElementClass(opts){if(!(this instanceof ElementClass))return new ElementClass(opts);opts||(opts={}),opts.nodeType&&(opts={el:opts}),this.opts=opts,this.el=opts.el||document.body,"object"!=typeof this.el&&(this.el=document.querySelector(this.el))}module.exports=function(opts){return new ElementClass(opts)},ElementClass.prototype.add=function(className){var el=this.el;if(el){if(""===el.className)return el.className=className;var classes=el.className.split(" ");return classes.indexOf(className)>-1?classes:(classes.push(className),el.className=classes.join(" "),classes)}},ElementClass.prototype.remove=function(className){var el=this.el;if(el&&""!==el.className){var classes=el.className.split(" "),idx=classes.indexOf(className);return idx>-1&&classes.splice(idx,1),el.className=classes.join(" "),classes}},ElementClass.prototype.has=function(className){var el=this.el;if(el){var classes=el.className.split(" ");return classes.indexOf(className)>-1}}},{}],4:[function(require,module,exports){(function(){"use strict";var alnum,ref;ref=require("../ref").ref,alnum={0:ref("0",48),1:ref("1",49),2:ref("2",50),3:ref("3",51),4:ref("4",52),5:ref("5",53),6:ref("6",54),7:ref("7",55),8:ref("8",56),9:ref("9",57),a:ref("A",65),b:ref("B",66),c:ref("C",67),d:ref("D",68),e:ref("E",69),f:ref("F",70),g:ref("G",71),h:ref("H",72),i:ref("I",73),j:ref("J",74),k:ref("K",75),l:ref("L",76),m:ref("M",77),n:ref("N",78),o:ref("O",79),p:ref("P",80),q:ref("Q",81),r:ref("R",82),s:ref("S",83),t:ref("T",84),u:ref("U",85),v:ref("V",86),w:ref("W",87),x:ref("X",88),y:ref("Y",89),z:ref("Z",90)},module.exports=alnum}).call(this)},{"../ref":10}],5:[function(require,module,exports){(function(){"use strict";var arrow,ref;ref=require("../ref").ref,arrow={left:ref("Left",37),up:ref("Up",38),right:ref("Right",39),down:ref("Down",40)},module.exports=arrow}).call(this)},{"../ref":10}],6:[function(require,module,exports){(function(){"use strict";var brand,ref;ref=require("../ref").ref,brand={apple:ref("Apple &#8984;",224),windows:{start:ref("Windows start",[91,92]),menu:ref("Windows menu",93)}},module.exports=brand}).call(this)},{"../ref":10}],7:[function(require,module,exports){(function(){"use strict";var punctuation,ref;ref=require("../ref").ref,punctuation={colon:ref("Colon/Semicolon",[59,186]),equal:ref("Equal/Plus",[61,187]),comma:ref("Comma/Less Than",[44,188]),hyphen:ref("Hyphen/Underscore",[45,109,189]),period:ref("Period/Greater Than",[46,190]),tilde:ref("Tilde/Back Tick",[96,192]),apostrophe:ref("Apostrophe/Quote",[39,222]),slash:{forward:ref("Forward Slash/Question Mark",[47,191]),backward:ref("Backward Slash/Pipe",220)},brace:{square:{open:ref("Open Square/Curly Brace",219),close:ref("Close Square/Curly Brace",221)}}},punctuation.semicolon=punctuation.colon,punctuation.plus=punctuation.equal,punctuation.lessthan=punctuation.comma,punctuation.underscore=punctuation.hyphen,punctuation.greaterthan=punctuation.period,punctuation.question=punctuation.slash.forward,punctuation.backtick=punctuation.tilde,punctuation.pipe=punctuation.slash.backward,punctuation.quote=punctuation.apostrophe,punctuation.brace.curly=punctuation.brace.square,module.exports=punctuation}).call(this)},{"../ref":10}],8:[function(require,module,exports){(function(){"use strict";var ref,special;ref=require("../ref").ref,special={backspace:ref("Backspace",8),tab:ref("Tab",9),enter:ref("Enter",13),shift:ref("Shift",16),ctrl:ref("Ctrl",17),alt:ref("Alt",18),caps:ref("Caps Lock",20),esc:ref("Escape",27),space:ref("Space",32),num:ref("Num Lock",144)},module.exports=special}).call(this)},{"../ref":10}],9:[function(require,module,exports){(function(){"use strict";var isRef,iterator,key,__indexOf=[].indexOf||function(item){for(var i=0,l=this.length;l>i;i++)if(i in this&&this[i]===item)return i;return-1},__hasProp={}.hasOwnProperty;isRef=require("./ref").isRef,key={},key.code={special:require("./code/special"),arrow:require("./code/arrow"),punctuation:require("./code/punctuation"),alnum:require("./code/alnum"),brand:require("./code/brand")},key.get=function(pressed){return iterator(key.code,pressed)},key.is=function(ref,pressed){return isRef(ref)||(ref=iterator(ref,pressed)),isRef(ref)?isRef(pressed)?pressed===ref:pressed===ref.code||__indexOf.call(ref.code,pressed)>=0:pressed===ref},iterator=function(context,pressed){var i,out,ref;for(i in context)if(__hasProp.call(context,i))if(ref=context[i],isRef(ref)){if(key.is(ref,pressed))return ref}else if(out=iterator(ref,pressed),isRef(out))return out},"undefined"!=typeof window&&(window.key=key),module.exports=key}).call(this)},{"./code/alnum":4,"./code/arrow":5,"./code/brand":6,"./code/punctuation":7,"./code/special":8,"./ref":10}],10:[function(require,module,exports){(function(){"use strict";var Reference,assertRef,isRef,ref;Reference=function(){function Reference(name,code){this.name=name,this.code=code}return Reference}(),ref=function(name,code){return new Reference(name,code)},isRef=function(ref){return ref instanceof Reference},assertRef=function(ref){if(!isRef(ref))throw new Error("Invalid reference");return ref},module.exports={ref:ref,isRef:isRef,assertRef:assertRef}}).call(this)},{}],11:[function(require,module,exports){var addDirtyProps=require("../add-dirty-props"),util=require("../util"),noop=require("../no-op"),passThrough=require("../pass-through"),debounce=require("../debounce");module.exports=function(_grid,name,lengthName,defaultSize){function setDescriptorsDirty(eventOptional){var event=eventOptional||{};event.type="grid-"+name+"-change",grid.eventLoop.fire(event),dirtyClean.setDirty(),builderDirtyClean.setDirty()}function updateDescriptorIndices(){var oldSelected=selected;selected=[],descriptors.forEach(function(descriptor,i){descriptor.index=i,descriptor.selected&&selected.push(i)}),selected.length!==oldSelected.length&&fireSelectionChange(),selected.sort(),oldSelected.sort();var change=oldSelected.some(function(idx,i){return idx!==selected[i]});change&&fireSelectionChange()}var grid=_grid,descriptors=[],numFixed=0,numHeaders=0,makeDirtyClean=require("../dirty-clean"),dirtyClean=makeDirtyClean(grid),builderDirtyClean=makeDirtyClean(grid),selected=[],fireSelectionChange=debounce(function(){grid.eventLoop.fire("grid-"+name+"-selection-change")},1),api={areBuildersDirty:builderDirtyClean.isDirty,isDirty:dirtyClean.isDirty,defaultSize:defaultSize,add:function(toAdd){toAdd&&(util.isArray(toAdd)||(toAdd=[toAdd]),toAdd.forEach(function(descriptor){if(descriptor.header)descriptors.splice(numHeaders,0,descriptor),numFixed++,numHeaders++;else{if(descriptor.fixed){if(descriptors.length&&!descriptors[descriptors.length-1].fixed)throw"Cannot add a fixed column after an unfixed one";numFixed++}descriptors.push(descriptor)}}),updateDescriptorIndices(),setDescriptorsDirty({action:"add",descriptors:toAdd}))},addHeaders:function(toAdd){toAdd&&(util.isArray(toAdd)||(toAdd=[toAdd]),toAdd.forEach(function(header){header.header=!0}),api.add(toAdd))},header:function(index){return descriptors[index]},get:function(index){return descriptors[index]},length:function(includeHeaders){var subtract=includeHeaders?0:numHeaders;return descriptors.length-subtract},remove:function(descriptor,dontUpdateIndex){var index=descriptors.indexOf(descriptor);-1!==index&&(descriptors.splice(index,1),descriptor.header?(numFixed--,numHeaders--):descriptor.fixed&&numFixed--),dontUpdateIndex||(updateDescriptorIndices(),setDescriptorsDirty({action:"remove",descriptors:[descriptor]}))},clear:function(includeHeaders){var removed;includeHeaders?(removed=descriptors,descriptors=[],numFixed=0,numHeaders=0):(removed=descriptors.slice(numHeaders),descriptors=descriptors.slice(0,numHeaders),numFixed=numHeaders),updateDescriptorIndices(),removed&&removed.length&&setDescriptorsDirty({action:"remove",descriptors:removed})},move:function(fromIndexes,target,after){if(util.isArray(fromIndexes)||(fromIndexes=[fromIndexes]),1===fromIndexes.length){var from=fromIndexes[0];descriptors.splice(target,0,descriptors.splice(from,1)[0]),setDescriptorsDirty({action:"move",descriptors:[api.get(from),api.get(target)]})}else{for(;-1!==fromIndexes.indexOf(target)&&-1!==target;)target--,after=!0;var toValue=descriptors[target],removed=fromIndexes.sort(function(a,b){return b-a}).map(function(fromIndex){var removedDescriptors=descriptors.splice(fromIndex,1);return removedDescriptors[0]});removed.reverse();var spliceArgs=[descriptors.indexOf(toValue)+(after?1:0),0].concat(removed);descriptors.splice.apply(descriptors,spliceArgs),updateDescriptorIndices(),setDescriptorsDirty({action:"move",descriptors:removed.concat(toValue)})}},numHeaders:function(){return numHeaders},numFixed:function(excludeHeaders){return numFixed-(excludeHeaders?numHeaders:0)},toVirtual:function(dataIndex){return dataIndex+api.numHeaders()},toData:function(virtualIndex){return virtualIndex-api.numHeaders()},select:function(indexes,dontFire){util.isArray(indexes)||(indexes=[indexes]);var changes=indexes.filter(function(idx){var hasDescriptor=!!api[name](idx);return hasDescriptor||console.warn("Tried to select index that had no descriptor",idx),hasDescriptor}).map(function(idx){var descriptor=api[name](idx);return descriptor.selected?void 0:(descriptor.selected=!0,selected.push(idx),idx)});changes.length&&!dontFire&&fireSelectionChange()},deselect:function(indexes,dontFire){util.isArray(indexes)||(indexes=[indexes]);var changes=indexes.filter(function(idx){var hasDescriptor=!!api[name](idx);return hasDescriptor||console.warn("Tried to deselect index that had no descriptor",idx),hasDescriptor}).map(function(idx){var descriptor=api[name](idx);return descriptor.selected?(descriptor.selected=!1,selected.splice(selected.indexOf(idx),1),idx):void 0});changes.length&&!dontFire&&fireSelectionChange()},toggleSelect:function(index){var descriptor=api[name](index);descriptor.selected?api.deselect(index):api.select(index)},clearSelected:function(){return api.deselect(api.getSelected().slice(0))},getSelected:function(){return selected},allSelected:function(){return api.getSelected().length===api.length()},create:function(builder){var descriptor={},fixed=!1;Object.defineProperty(descriptor,"fixed",{enumerable:!0,get:function(){return descriptor.header||fixed},set:function(_fixed){fixed=_fixed}});var expandedClass,expanded=!1;return Object.defineProperty(descriptor,"expanded",{get:function(){return expanded},set:function(exp){if(descriptor.children)if(expanded=exp){var spliceArgs=[descriptor.index+1,0].concat(descriptor.children);descriptors.splice.apply(descriptors,spliceArgs),updateDescriptorIndices(),setDescriptorsDirty({action:"add",descriptors:descriptor.children});var top="row"===name?descriptor.index:0,left="col"===name?descriptor.index:0,height="row"===name?1:1/0,width="col"===name?1:1/0;expandedClass=grid.cellClasses.create(top,left,"grid-expanded",height,width,"virtual"),grid.cellClasses.add(expandedClass)}else descriptors.splice(descriptor.index+1,descriptor.children.length),updateDescriptorIndices(),setDescriptorsDirty({action:"remove",descriptors:[descriptor.children]}),expandedClass&&grid.cellClasses.remove(expandedClass)}}),addDirtyProps(descriptor,["builder"],[builderDirtyClean]),descriptor.builder=builder,addDirtyProps(descriptor,[{name:lengthName,onDirty:function(){setDescriptorsDirty({action:"size",descriptors:[descriptor]})}},{name:"hidden",onDirty:function(){setDescriptorsDirty({action:"hide",descriptors:[descriptor]})}}],[dirtyClean])},createBuilder:function(render,update){return{render:render||noop,update:update||passThrough}}};return api[lengthName]=function(index){var descriptor=descriptors[index];return descriptor?descriptor.hidden?0:descriptor[lengthName]||api.defaultSize:0/0},api[name]=function(index){return descriptors[index+numHeaders]},api}},{"../add-dirty-props":12,"../debounce":25,"../dirty-clean":27,"../no-op":33,"../pass-through":34,"../util":42}],12:[function(require,module,exports){module.exports=function(obj,props,dirtyCleans){return props.forEach(function(prop){var val,name=prop.name||prop;Object.defineProperty(obj,name,{enumerable:!0,get:function(){return val},set:function(_val){var oldVal=val,isChanged=_val!==oldVal;isChanged&&prop.preDirty&&prop.preDirty(),val=_val,isChanged&&(dirtyCleans.forEach(function(dirtyClean){dirtyClean.setDirty()}),prop.onDirty&&prop.onDirty(_val,oldVal))}})}),obj}},{}],13:[function(require,module,exports){module.exports=angular.module("grid-builder",[]).factory("GridBuilderSrvc",["$compile",function($compile){var GridBuilderSrvc={};return GridBuilderSrvc.destroy=function(elem){if(elem){var $prevElem=angular.element(elem);if(!$prevElem.data("$scope"))return;var $previousScope=$prevElem.scope();$previousScope&&$previousScope.$destroy(),$prevElem.remove()}},GridBuilderSrvc.render=function($scope,tpl,initScopeFn){var scope=$scope.$new();initScopeFn&&initScopeFn(scope);var $elem=$compile(tpl)(scope);return $elem.on("grid-rendered-elem-destroy",function(){GridBuilderSrvc.destroy($elem)}),$elem[0]},GridBuilderSrvc}])},{}],14:[function(require,module,exports){module.exports=angular.module("grid-decorator",[]).factory("GridDecoratorSrvc",["$compile",function($compile){var GridDecoratorSrvc={render:function(opts){var compiled=$compile(opts.template)(opts.$scope);return opts.$scope.$apply(),compiled.on("decorator-destroy",function(){opts.$scope.$destroy(),setTimeout(function(){compiled.remove(),compiled.off("decorator-destroy")},1)}),opts.events&&(compiled[0].style.pointerEvents="all"),compiled[0]},headerDecorators:function(grid,model){var origAnnotate=model.annotateDecorator;model.annotateDecorator=function(dec){dec.render=function(){return GridDecoratorSrvc.render(dec.renderOpts)},origAnnotate&&origAnnotate(dec)},require("../header-decorators")(grid,model)}};return GridDecoratorSrvc}])},{"../header-decorators":29}],15:[function(require,module,exports){var positionRange=require("../position-range"),makeDirtyClean=require("../dirty-clean"),addDirtyProps=require("../add-dirty-props");module.exports=function(_grid){function regnerateCache(){cachedClassMatrix=[],api.getAll().forEach(function(descriptor){addOrRemoveCachedClass(descriptor)})}function addOrRemoveCachedClass(descriptor,isRemove){for(var r=descriptor.top;r<Math.min(descriptor.top+descriptor.height,grid.rowModel.length(!0));r++)for(var c=descriptor.left;c<Math.min(descriptor.left+descriptor.width,grid.colModel.length(!0));c++){var vRow=grid[descriptor.space].row.toVirtual(r),vCol=grid[descriptor.space].col.toVirtual(c),cols=cachedClassMatrix[vRow];cols||(cols=cachedClassMatrix[vRow]=[]);var cellClasses=cols[vCol];if(cellClasses)if(isRemove){var index=cellClasses.indexOf(descriptor["class"]);-1!==index&&cellClasses.splice(index,1)}else-1===cellClasses.indexOf(descriptor["class"])&&cellClasses.push(descriptor["class"]);else isRemove||(cols[vCol]=[descriptor["class"]])}}var grid=_grid,dirtyClean=makeDirtyClean(grid),descriptors=[],cachedClassMatrix=[],api={add:function(descriptor){descriptors.push(descriptor),addOrRemoveCachedClass(descriptor),dirtyClean.setDirty()},remove:function(descriptor){var index=descriptors.indexOf(descriptor);-1!==index&&(descriptors.splice(index,1),addOrRemoveCachedClass(descriptor,!0),dirtyClean.setDirty())},getAll:function(){return descriptors.slice(0)},getCachedClasses:function(vRow,vCol){return cachedClassMatrix[vRow]&&cachedClassMatrix[vRow][vCol]||[]},create:function(top,left,className,height,width,space){function classPreDirty(){addOrRemoveCachedClass(descriptor,!0)}function classOnDirty(){addOrRemoveCachedClass(descriptor)}var thisDirtyClean=makeDirtyClean(grid),descriptor={};return positionRange(descriptor,thisDirtyClean,dirtyClean,{preDirty:classPreDirty,onDirty:classOnDirty}),addDirtyProps(descriptor,[{name:"class",preDirty:classPreDirty,onDirty:classOnDirty}],[thisDirtyClean,dirtyClean]),descriptor.top=top,descriptor.left=left,descriptor.height=height||1,descriptor.width=width||1,descriptor["class"]=className,descriptor.space=space||descriptor.space,descriptor},isDirty:dirtyClean.isDirty};return grid.eventLoop.bind("grid-row-change",regnerateCache),grid.eventLoop.bind("grid-col-change",regnerateCache),api}},{"../add-dirty-props":12,"../dirty-clean":27,"../position-range":36}],16:[function(require,module,exports){var customEvent=require("../custom-event"),PROPS_TO_COPY_FROM_MOUSE_EVENTS=["clientX","clientY","gridX","gridY","layerX","layerY","row","col","realRow","realCol"];module.exports=function(_grid){function calculateColScrollDiff(e){var colDiff=0;return e.clientX>(grid.container&&grid.container.getBoundingClientRect().right||window.innerWidth)?colDiff=1:grid.viewPort.toGridX(e.clientX)<grid.virtualPixelCellModel.fixedWidth()&&(colDiff=-1),colDiff}function calculateRowScrollDiff(e){var rowDiff=0;return e.clientY>(grid.container&&grid.container.getBoundingClientRect().bottom||window.innerHeight)?rowDiff=1:grid.viewPort.toGridY(e.clientY)<grid.virtualPixelCellModel.fixedHeight()&&(rowDiff=-1),rowDiff}function setupDragEventForMouseDown(downEvent){function handleMouseUp(e){clearInterval(scrollInterval),unbindMove(),unbindUp(),unbindAutoScrollDrag&&unbindAutoScrollDrag();var dragEnd=createCustomEventFromMouseEvent("grid-drag-end",e);grid.eventLoop.fire(dragEnd)}var unbindAutoScrollDrag,lastDragRow=downEvent.row,lastDragCol=downEvent.col,dragStarted=!1,lastX=downEvent.clientX,lastY=downEvent.clientY,unbindMove=grid.eventLoop.bind("mousemove",window,function(e){return dragStarted&&!e.which?(console.log("mousemove unbind, how on earth do these happen?"),void handleMouseUp(e)):(dragStarted||(lastX===e.clientX&&lastY===e.clientY&&console.error("Got a mouse move event with ",e.clientX,",",e.clientY," when the last position was ",lastX,",",lastY),createAndFireCustomMouseEvent("grid-drag-start",downEvent,function(dragStart){var onlyFixedRows=!calculateRowScrollDiff(e),onlyFixedCols=!calculateColScrollDiff(e);dragStart.enableAutoScroll=function(){unbindAutoScrollDrag&&unbindAutoScrollDrag(),unbindAutoScrollDrag=grid.eventLoop.bind("grid-drag",function(e){var newRowDiff=calculateRowScrollDiff(e);onlyFixedRows=!newRowDiff;var rowDiff=onlyFixedRows?0:newRowDiff,newColDiff=calculateColScrollDiff;onlyFixedCols=!newColDiff;var colDiff=onlyFixedCols?0:newColDiff(e);clearInterval(scrollInterval),(rowDiff||colDiff)&&(scrollInterval=grid.interval(function(){grid.cellScrollModel.scrollTo(grid.cellScrollModel.row+rowDiff,grid.cellScrollModel.col+colDiff)},100))})}}),dragStarted=!0),createAndFireCustomMouseEvent("grid-drag",e),void((e.row!==lastDragRow||e.col!==lastDragCol)&&(createAndFireCustomMouseEvent("grid-cell-drag",e),lastDragRow=e.row,lastDragCol=e.col)))}),unbindUp=grid.eventLoop.bind("mouseup",window,handleMouseUp)}function createCustomEventFromMouseEvent(type,e){var event=customEvent(type,!0,!0);return PROPS_TO_COPY_FROM_MOUSE_EVENTS.forEach(function(prop){event[prop]=e[prop]}),event.originalEvent=e,event}function createAndFireCustomMouseEvent(type,e,annotateEvent){var drag=createCustomEventFromMouseEvent(type,e);return annotateEvent&&(drag=annotateEvent(drag)||drag),e.target?e.target.dispatchEvent(drag):grid.eventLoop.fire(drag),drag}var scrollInterval,grid=_grid,model={};model._annotateEvent=function(e){switch(e.type){case"click":case"dblclick":case"mousedown":case"mousemove":case"mouseup":model._annotateEventInternal(e)}},model._annotateEventFromViewCoords=function(e,viewRow,viewCol){return e.realRow=viewRow,e.realCol=viewCol,e.virtualRow=grid.view.row.toVirtual(e.realRow),e.virtualCol=grid.view.col.toVirtual(e.realCol),e.row=grid.virtual.row.toData(e.virtualRow),e.col=grid.virtual.col.toData(e.virtualCol),e},model._annotateEventInternal=function(e){var y=grid.viewPort.toGridY(e.clientY),x=grid.viewPort.toGridX(e.clientX),viewRow=grid.viewPort.getRowByTop(y),viewCol=grid.viewPort.getColByLeft(x);model._annotateEventFromViewCoords(e,viewRow,viewCol),e.gridX=x,e.gridY=y};var lastMoveRow,lastMoveCol;return grid.eventLoop.addInterceptor(function(e){model._annotateEvent(e),"mousedown"===e.type?e.currentTarget===grid.container&&setupDragEventForMouseDown(e):"mousemove"===e.type&&(e.row!==lastMoveRow||e.col!==lastMoveCol)&&(createAndFireCustomMouseEvent("grid-cell-mouse-move",e),lastMoveRow=e.row,lastMoveCol=e.col)}),model}},{"../custom-event":24}],17:[function(require,module,exports){var util=require("../util");module.exports=function(_grid){function convertVirtualToScroll(virtualCoord,rowOrCol){return virtualCoord-grid[rowOrCol+"Model"].numFixed()}function getScrollToRowOrCol(virtualCoord,rowOrCol,heightWidth){var currentScroll=model[rowOrCol],scrollTo=currentScroll;if(grid.viewPort[rowOrCol+"IsInView"](virtualCoord))return scrollTo;var targetScroll=convertVirtualToScroll(virtualCoord,rowOrCol);if(currentScroll>targetScroll)scrollTo=targetScroll;else if(targetScroll>currentScroll){var lengthToCell=grid.virtualPixelCellModel[heightWidth](0,virtualCoord),numFixed=grid[rowOrCol+"Model"].numFixed();scrollTo=0;for(var i=numFixed;virtualCoord>i&&(lengthToCell-=grid.virtualPixelCellModel[heightWidth](i),scrollTo=i-(numFixed-1),!(lengthToCell<=grid.viewPort[heightWidth]));i++);}return scrollTo}var row,grid=_grid,dirtyClean=require("../dirty-clean")(grid),model={col:0};return Object.defineProperty(model,"row",{enumerable:!0,get:function(){return row},set:function(r){row=r}}),model.row=0,model.isDirty=dirtyClean.isDirty,grid.eventLoop.bind("grid-row-change",function(e){switch(e.action){case"remove":model.scrollTo(0,model.col)}}),model.scrollTo=function(r,c,dontFire,fromPixelModel){if(!isNaN(r)&&!isNaN(c)){var maxRow=(grid.rowModel.length()||1)-1,maxCol=(grid.colModel.length()||1)-1,lastRow=model.row,lastCol=model.col;if(model.row=util.clamp(r,0,maxRow),model.col=util.clamp(c,0,maxCol),(lastRow!==model.row||lastCol!==model.col)&&(dirtyClean.setDirty(),dontFire||grid.eventLoop.fire("grid-cell-scroll"),!fromPixelModel)){var top=grid.virtualPixelCellModel.height(grid.rowModel.numFixed(),model.row+grid.rowModel.numFixed()-1),left=grid.virtualPixelCellModel.width(grid.colModel.numFixed(),model.col+grid.colModel.numFixed()-1);grid.pixelScrollModel.scrollTo(top,left,!0)}}},model.scrollIntoView=function(dataRow,dataCol){dataRow=grid.virtual.row.clamp(grid.data.row.toVirtual(dataRow)),dataCol=grid.virtual.col.clamp(grid.data.col.toVirtual(dataCol));var newRow=getScrollToRowOrCol(dataRow,"row","height"),newCol=getScrollToRowOrCol(dataCol,"col","width");model.scrollTo(newRow,newCol)},model}},{"../dirty-clean":27,"../util":42}],18:[function(require,module,exports){module.exports=function(_grid){var grid=_grid,api=require("../abstract-row-col-model")(grid,"col","width",100);return api}},{"../abstract-row-col-model":11}],19:[function(require,module,exports){{var elementClass=require("element-class"),util=require("../util"),ctrlOrCmd=require("../ctrl-or-cmd");require("key")}module.exports=function(_grid){function makeReorderDecorator(headerDecorator){var wasSelectedAtMousedown=!1;return headerDecorator._onMousedown=function(e){wasSelectedAtMousedown=grid.data.col.get(e.col).selected,wasSelectedAtMousedown&&!ctrlOrCmd(e)&&grid.eventLoop.stopBubbling(e)},headerDecorator._onDragStart=function(e){function removeDecoratorsAndUnbind(){var removedDecs=api._dragRects.concat(api._targetCol);return grid.decorators.remove(removedDecs),headerDecorator._unbindDrag(),headerDecorator._unbindDragEnd(),headerDecorator._unbindKeyDown&&headerDecorator._unbindKeyDown(),!0}if(!(e.realCol<grid.colModel.numFixed())&&wasSelectedAtMousedown){e.enableAutoScroll&&e.enableAutoScroll(),grid.eventLoop.stopBubbling(e);var startCol=headerDecorator.left;api._targetCol=grid.decorators.create(0,void 0,1/0,1,"cell","real"),api._targetCol.postRender=function(div){div.setAttribute("class","grid-reorder-target"),api._targetCol._renderedElem=div},grid.decorators.add(api._targetCol);var selected=grid.colModel.getSelected();api._dragRects=selected.map(function(dataCol){var viewCol=grid.data.col.toView(dataCol),dragRect=grid.decorators.create(0,void 0,1/0,void 0,"px","real");return dragRect.colOffset=e.gridX-api._decorators[viewCol].getDecoratorLeft(),dragRect.postRender=function(div){div.setAttribute("class","grid-drag-rect")},dragRect.width=grid.viewPort.getColWidth(viewCol),dragRect}),grid.decorators.add(api._dragRects),headerDecorator._unbindKeyDown=grid.escapeStack&&grid.escapeStack.addEscapeHandler(removeDecoratorsAndUnbind),headerDecorator._unbindDrag=grid.eventLoop.bind("grid-drag",function(e){api._dragRects.forEach(function(dragRect){dragRect.left=util.clamp(e.gridX-dragRect.colOffset,grid.viewPort.getColLeft(grid.colModel.numFixed()),1/0)}),api._targetCol.left=util.clamp(e.realCol,grid.colModel.numFixed(),1/0),api._targetCol.moveAfter=e.realCol>startCol,api._targetCol.moveAfter?elementClass(api._targetCol._renderedElem).add("right"):elementClass(api._targetCol._renderedElem).remove("right")}),headerDecorator._unbindDragEnd=grid.eventLoop.bind("grid-drag-end",function(){var targetCol=api._targetCol.left;grid.colModel.move(selected.map(function(dataCol){return grid.data.col.toVirtual(dataCol)}),grid.viewPort.toVirtualCol(targetCol),api._targetCol.moveAfter),removeDecoratorsAndUnbind()})}},headerDecorator.postRender=function(div){div.setAttribute("class","grid-col-reorder"),grid.eventLoop.bind("grid-drag-start",div,headerDecorator._onDragStart),grid.eventLoop.bind("mousedown",div,headerDecorator._onMousedown)},headerDecorator}var grid=_grid,api={annotateDecorator:makeReorderDecorator};return require("../header-decorators")(grid,api),api}},{"../ctrl-or-cmd":23,"../header-decorators":29,"../util":42,"element-class":3,key:9}],20:[function(require,module,exports){require("key");module.exports=function(_grid){function annotateDecorator(headerDecorator){var col=headerDecorator.left;headerDecorator._dragLine=grid.decorators.create(0,void 0,1/0,1,"px","real"),headerDecorator._dragLine.postRender=function(div){div.setAttribute("class","grid-drag-line")},headerDecorator._onMousedown=function(e){grid.eventLoop.stopBubbling(e)},headerDecorator._onDragStart=function(e){function removeDecoratorsAndUnbind(){return grid.decorators.remove(headerDecorator._dragLine),headerDecorator._unbindDrag(),headerDecorator._unbindDragEnd(),headerDecorator._unbindKeyDown&&headerDecorator._unbindKeyDown(),!0}grid.eventLoop.stopBubbling(e),grid.decorators.add(headerDecorator._dragLine),headerDecorator._unbindDrag=grid.eventLoop.bind("grid-drag",function(e){var minX=headerDecorator.getDecoratorLeft()+10;headerDecorator._dragLine.left=Math.max(e.gridX,minX)}),headerDecorator._unbindKeyDown=grid.escapeStack&&grid.escapeStack.addEscapeHandler(removeDecoratorsAndUnbind),headerDecorator._unbindDragEnd=grid.eventLoop.bind("grid-drag-end",function(e){var newWidth=headerDecorator._dragLine.left-headerDecorator.getDecoratorLeft();grid.view.col.get(col).width=newWidth,grid.colModel.getSelected().forEach(function(dataIdx){grid.data.col.get(dataIdx).width=newWidth}),removeDecoratorsAndUnbind()})},headerDecorator.postRender=function(div){div.style.transform="translateX(50%)",div.style.webkitTransform="translateX(50%)",div.style.removeProperty("left"),div.setAttribute("class","col-resize"),div.setAttribute("dts","grid_header_resize"),grid.eventLoop.bind("grid-drag-start",div,headerDecorator._onDragStart),grid.eventLoop.bind("mousedown",div,headerDecorator._onMousedown)}}var grid=_grid,api={annotateDecorator:annotateDecorator};return require("../header-decorators")(grid,api),api}},{"../header-decorators":29,key:9}],21:[function(require,module,exports){var tsv=require("../tsv"),debounce=require("../debounce");module.exports=function(_grid){function getCopyPasteRange(){var selectionRange=grid.navigationModel.selection;return-1===selectionRange.top&&(selectionRange={top:grid.navigationModel.focus.row,left:grid.navigationModel.focus.col,width:1,height:1}),selectionRange}var grid=_grid,model={};grid.eventLoop.bind("copy",function(e){if(!grid.focused)return void(e.target===grid.textarea&&e.preventDefault());var copyTable=document.createElement("table"),tableBody=document.createElement("tbody");copyTable.appendChild(tableBody);var tsvData=[],selectionRange=getCopyPasteRange(),gotNull=!1;grid.data.iterate(selectionRange,function(){var row=document.createElement("tr");tableBody.appendChild(row);var array=[];return tsvData.push(array),{row:row,array:array}},function(r,c,rowResult){var data=grid.dataModel.getCopyData(r,c);if(null==data)return gotNull=!0;var td=document.createElement("td");td.innerHTML=data||" ",rowResult.row.appendChild(td),rowResult.array.push(td.textContent)}),gotNull||(e.clipboardData.setData("text/plain",tsv.stringify(tsvData)),e.clipboardData.setData("text/html",copyTable.outerHTML),e.preventDefault(),setTimeout(function(){grid.eventLoop.fire("grid-copy")},1))}),grid.eventLoop.bind("paste",function(e){if(grid.focused){var selectionRange=getCopyPasteRange();if(!e.clipboardData||!e.clipboardData.getData)return void console.warn("no clipboard data on paste event");var pasteData=tsv.parse(e.clipboardData.getData("text/plain")),pasteHtml=e.clipboardData.getData("text/html");e.preventDefault(),setTimeout(function(){var tempDiv=document.createElement("div");tempDiv.innerHTML=pasteHtml,tempDiv.querySelector("table")&&(pasteData=[],[].forEach.call(tempDiv.querySelectorAll("tr"),function(tr){var row=[];pasteData.push(row),[].forEach.call(tr.querySelectorAll("td"),function(td){row.push(td.innerHTML)})}));var singlePasteValue,dataChanges=[];if(1===pasteData.length&&1===pasteData[0].length&&(singlePasteValue=pasteData[0][0]),singlePasteValue){var ranges=[selectionRange];ranges=ranges.concat(grid.navigationModel.otherSelections),ranges.forEach(function(range){grid.data.iterate(range,function(r,c){var pasteValue=singlePasteValue;dataChanges.push({row:r,col:c,data:pasteValue&&pasteValue.trim(),paste:!0})})})}else{var top=selectionRange.top,left=selectionRange.left;pasteData.forEach(function(row,r){row.forEach(function(pasteValue,c){void 0!=pasteValue&&dataChanges.push({row:r+top,col:c+left,data:pasteValue&&pasteValue.trim(),paste:!0})})});var newSelection={top:top,left:left,height:pasteData.length,width:pasteData[0].length};grid.navigationModel.clearSelection(),grid.navigationModel.setSelection(newSelection)}grid.dataModel.set(dataChanges)},1)}});var maybeSelectText=debounce(function(){model.isSelectionDisabled&&model.isSelectionDisabled()||!grid.focused||(grid.textarea.value=grid.dataModel.get(grid.navigationModel.focus.row,grid.navigationModel.focus.col).formatted||".",grid.textarea.select())},1);return model._maybeSelectText=maybeSelectText,grid.eventLoop.bind("keyup",function(e){maybeSelectText()}),grid.eventLoop.bind("grid-focus",function(e){maybeSelectText()}),grid.eventLoop.bind("mousedown",function(e){e.target===grid.textarea&&maybeSelectText()}),model}},{"../debounce":25,"../tsv":41}],22:[function(require,module,exports){var elementClass=require("element-class"),dirtyClean=require("../dirty-clean"),util=require("../util"),rangeUtil=require("../range-util"),passThrough=require("../pass-through"),capitalize=require("capitalize");

module.exports=function(opts){function GridMarker(){}function setupTextareaForContainer(textarea,container){textarea.addEventListener("focus",function(){container&&elementClass(container).add("focus"),textarea.select(),grid.focused=!0,grid.eventLoop.fire("grid-focus")}),textarea.addEventListener("blur",function(){container&&elementClass(container).remove("focus"),grid.focused=!1,grid.eventLoop.fire("grid-blur")});var widthResetTimeout;grid.eventLoop.addInterceptor(function(e){"mousedown"===e.type&&2===e.button&&(textarea.style.width="100%",textarea.style.height="100%",textarea.style.zIndex=1,clearTimeout(widthResetTimeout),widthResetTimeout=setTimeout(function(){textarea.style.zIndex=0,textarea.style.width="0px",textarea.style.height="1px"},1))}),container.appendChild(textarea),container.getAttribute("tabIndex")||(container.tabIndex=-1),container.addEventListener("focus",function(){textarea&&textarea.focus()})}function createFocusTextArea(){var textarea=document.createElement("textarea");return textarea.setAttribute("dts","grid-textarea"),util.position(textarea,0,0),textarea.style.width="0px",textarea.style.height="1px",textarea.style.maxWidth="100%",textarea.style.maxHeight="100%",textarea.style.zIndex=0,textarea.style.overflow="hidden",textarea.style.background="transparent",textarea.style.color="transparent",textarea.style.border="none",textarea.style.boxShadow="none",textarea.style.cursor="default",textarea.classList.add("grid-textarea"),textarea.setAttribute("ondragstart","return false;"),textarea}function addUtilsToCore(){function iterateRange(){var rowResult,args=rangeUtil.getArgs(arguments),range=args.range,rowFn=args.rowFn,cellFn=args.cellFn;rowloop:for(var r=range.top;r<range.top+range.height;r=this.row.next(r)){rowResult=void 0,rowFn&&(rowResult=rowFn(r));colloop:for(var c=range.left;c<range.left+range.width;c=this.col.next(c))if(cellFn){var result=cellFn(r,c,rowResult);if(result===!1)break rowloop;if(result===!0)break colloop}}}function iterateWhileHidden(step,start){step=step||1;for(var i=start+step;i<this.count()&&i>=0;i+=step)if(!this.get(i).hidden)return i}function addToDimension(dim,spaceName,getter){return dim.get=function(idx){return getter(this.toVirtual(idx))}.bind(dim),dim.next=iterateWhileHidden.bind(dim,1),dim.prev=iterateWhileHidden.bind(dim,-1),dim.clamp=function(idx){return util.clamp(idx,0,this.count()-1)}.bind(dim),dim.indexes=function(){var opts;opts=arguments[0],opts=opts||{},opts.from=opts.from||0;var count=this.count();opts.to=opts.to+1||opts.length&&opts.length+opts.from||count;for(var indexes=[],idx=Math.max(opts.from,0);idx<Math.min(opts.to,count);idx=opts.reverse?this.prev(idx):this.next(idx))indexes.push(idx);return indexes},dim.iterate=function(){var opts,fn;2===arguments.length?(opts=arguments[0],fn=arguments[1]):fn=arguments[0],dim.indexes(opts).some(function(idx){return fn(idx)})},dim["to"+capitalize(spaceName)]=passThrough,dim}function addToSpace(spaceName){var space=grid[spaceName];space.iterate=iterateRange.bind(space),addToDimension(space.col,spaceName,function(idx){return grid.colModel.get(idx)}),addToDimension(space.row,spaceName,function(idx){return grid.rowModel.get(idx)}),space.up=space.row.prev,space.down=space.row.next,space.left=space.col.prev,space.right=space.col.next}grid.data={col:{toVirtual:function(dataCol){return grid.colModel.toVirtual(dataCol)},toView:function(dataCol){return grid.virtual.col.toView(this.toVirtual(dataCol))},count:function(){return grid.colModel.length()}},row:{toVirtual:function(dataRow){return grid.rowModel.toVirtual(dataRow)},toView:function(dataRow){return grid.virtual.row.toView(this.toVirtual(dataRow))},count:function(){return grid.rowModel.length()}}},addToSpace("data"),grid.virtual={col:{toData:function(virtualCol){return grid.colModel.toData(virtualCol)},toView:function(virtualCol){return grid.viewPort.toRealCol(virtualCol)},count:function(){return grid.colModel.length(!0)}},row:{toData:function(virtualRow){return grid.rowModel.toData(virtualRow)},toView:function(virtualRow){return grid.viewPort.toRealRow(virtualRow)},count:function(){return grid.rowModel.length(!0)}}},addToSpace("virtual"),grid.view={col:{toData:function(viewCol){return grid.virtual.col.toData(this.toVirtual(viewCol))},toVirtual:function(viewCol){return grid.viewPort.toVirtualCol(viewCol)},count:function(){return grid.viewPort.cols}},row:{toData:function(viewRow){return grid.virtual.row.toData(this.toVirtual(viewRow))},toVirtual:function(viewRow){return grid.viewPort.toVirtualRow(viewRow)},count:function(){return grid.viewPort.rows}}},addToSpace("view"),timeouts=[],grid.timeout=function(){var id=setTimeout.apply(window,arguments);return timeouts.push(id),id},intervals=[],grid.interval=function(){var id=setInterval.apply(window,arguments);return intervals.push(id),id}}var grid=new GridMarker;grid.eventLoop=require("../event-loop")(grid),grid.decorators=require("../decorators")(grid),grid.cellClasses=require("../cell-classes")(grid),grid.rowModel=require("../row-model")(grid),grid.colModel=require("../col-model")(grid),grid.dataModel=require("../simple-data-model")(grid),grid.virtualPixelCellModel=require("../virtual-pixel-cell-model")(grid),grid.cellScrollModel=require("../cell-scroll-model")(grid),grid.cellMouseModel=require("../cell-mouse-model")(grid),grid.viewPort=require("../view-port")(grid),addUtilsToCore(),grid.viewLayer=require("../view-layer")(grid),grid.navigationModel=require("../navigation-model")(grid),grid.pixelScrollModel=require("../pixel-scroll-model")(grid),grid.colResize=require("../col-resize")(grid),opts&&opts.col&&opts.col.disableReorder||(grid.colReorder=require("../col-reorder")(grid)),grid.showHiddenCols=require("../show-hidden-cols")(grid),grid.copyPaste=require("../copy-paste")(grid);var drawRequested=!1;grid.requestDraw=function(){grid.eventLoop.isRunning?drawRequested=!0:grid.viewLayer.draw()},grid.eventLoop.bind("grid-draw",function(){drawRequested=!1}),grid.eventLoop.addExitListener(function(){drawRequested&&grid.viewLayer.draw()});var intervals,timeouts;return grid.eventLoop.bind("grid-destroy",function(){intervals.forEach(function(id){clearInterval(id)}),timeouts.forEach(function(id){clearTimeout(id)})}),grid.build=function(container){grid.container=container,setupTextareaForContainer(grid.textarea,container),grid.viewPort.sizeToContainer(container),grid.viewLayer.build(container),grid.eventLoop.setContainer(container),container.style.overflow="hidden",container.addEventListener("scroll",function(){container.scrollTop=0,container.scrollLeft=0})},grid.makeDirtyClean=function(){return dirtyClean(grid)},grid.eventIsOnCells=function(e){var target=e.target;return target&&target.classList&&(target.classList.contains("grid-col-reorder")||target.classList.contains("grid-cell"))||target===grid.textarea},grid.textarea=createFocusTextArea(),grid.destroy=function(){grid.eventLoop.fire("grid-destroy")},grid}},{"../cell-classes":15,"../cell-mouse-model":16,"../cell-scroll-model":17,"../col-model":18,"../col-reorder":19,"../col-resize":20,"../copy-paste":21,"../decorators":26,"../dirty-clean":27,"../event-loop":28,"../navigation-model":32,"../pass-through":34,"../pixel-scroll-model":35,"../range-util":37,"../row-model":38,"../show-hidden-cols":39,"../simple-data-model":40,"../util":42,"../view-layer":43,"../view-port":44,"../virtual-pixel-cell-model":45,capitalize:2,"element-class":3}],23:[function(require,module,exports){module.exports=function(e){return window.navigator.userAgent.match(/win/i)?e.ctrlKey:e.metaKey}},{}],24:[function(require,module,exports){module.exports=function(name,bubbles,cancelable,detail){var event=document.createEvent("CustomEvent");return event.initCustomEvent(name,bubbles,cancelable,detail),event}},{}],25:[function(require,module,exports){module.exports=function(fn,delay){var f=function(){f.timeout&&(clearTimeout(f.timeout),f.timeout=void 0),f.canceled||(f.timeout=setTimeout(fn,delay)),f.cancel=function(){clearTimeout(f.timeout),f.timeout=void 0,f.canceled=!0}};return f}},{}],26:[function(require,module,exports){var util=require("../util"),makeDirtyClean=require("../dirty-clean"),positionRange=require("../position-range");module.exports=function(_grid){var grid=_grid,dirtyClean=makeDirtyClean(grid),aliveDecorators=[],deadDecorators=[],decorators={add:function(decorators){util.isArray(decorators)||(decorators=[decorators]),decorators.forEach(function(decorator){aliveDecorators.push(decorator)}),dirtyClean.setDirty()},remove:function(decorators){util.isArray(decorators)||(decorators=[decorators]),decorators.forEach(function(decorator){var index=aliveDecorators.indexOf(decorator);-1!==index&&(aliveDecorators.splice(index,1),deadDecorators.push(decorator),dirtyClean.setDirty())})},getAlive:function(){return aliveDecorators.slice(0)},popAllDead:function(){var oldDead=deadDecorators;return deadDecorators=[],oldDead},isDirty:dirtyClean.isDirty,create:function(t,l,h,w,u,s){var decorator={},thisDirtyClean=makeDirtyClean(grid);return positionRange(decorator,thisDirtyClean,dirtyClean),decorator.top=t,decorator.left=l,decorator.height=h,decorator.width=w,decorator.units=u||decorator.units,decorator.space=s||decorator.space,decorator.render=function(){var div=document.createElement("div");return div.style.position="absolute",div.style.top="0px",div.style.left="0px",div.style.bottom="0px",div.style.right="0px",decorator.postRender&&decorator.postRender(div),div},decorator}};return decorators}},{"../dirty-clean":27,"../position-range":36,"../util":42}],27:[function(require,module,exports){module.exports=function(_grid){var grid=_grid,dirty=!0;grid.eventLoop.bind("grid-draw",function(){api.setClean()});var api={isDirty:function(){return dirty},isClean:function(){return!dirty},setDirty:function(){dirty=!0,grid.requestDraw&&grid.requestDraw()},setClean:function(){dirty=!1}};return api}},{}],28:[function(require,module,exports){var mousewheel=require("../mousewheel"),util=require("../util"),listeners=require("../listeners"),EVENTS=["click","mousedown","mouseup","mousemove","dblclick","keydown","keypress","keyup","copy","paste"],GRID_EVENTS=["grid-drag-start","grid-drag","grid-cell-drag","grid-drag-end","grid-cell-mouse-move"],eventLoop=function(_grid){function getHandlers(name){var handlers=handlersByName[name];return handlers||(handlers=handlersByName[name]=[]),handlers}function bindToDomElement(elem,name,listener){elem.addEventListener(name,listener);var unbindFn=function(){elem.removeEventListener(name,listener),domUnbindFns.splice(domUnbindFns.indexOf(unbindFn),1)};return domUnbindFns.push(unbindFn),unbindFn}function getHandlerFromArgs(args){var handler=args.filter(function(arg){return"function"==typeof arg})[0];return handler}function loopWith(fn){return function(e){loop(e,fn)}}function loop(e,bodyFn){eloop.logTargets&&console.log("target",e.target,"currentTarget",e.currentTarget);var isOuterLoopRunning=eloop.isRunning;eloop.isRunning=!0,interceptors.notify(e),e.gridStopBubbling||bodyFn(e),isOuterLoopRunning||(eloop.isRunning=!1,exitListeners.notify(e))}var unbindAll,eloop={isRunning:!1},handlersByName={},domUnbindFns=[];eloop.setContainer=function(container){var unbindMouseWheelFn=mousewheel.bind(container,mainLoop);EVENTS.forEach(function(name){bindToDomElement(container,name,mainLoop)}),GRID_EVENTS.forEach(function(name){bindToDomElement(window,name,mainLoop)}),unbindAll=function(){unbindMouseWheelFn(),domUnbindFns.slice(0).forEach(function(unbind){unbind()}),Object.keys(handlersByName).forEach(function(key){handlersByName[key]=[]})}},eloop.bind=function(){var args=Array.prototype.slice.call(arguments,0),name=args.filter(function(arg){return"string"==typeof arg})[0],handler=getHandlerFromArgs(args);if(!handler||!name)throw"cannot bind without at least name and function";var elem=args.filter(function(arg){return util.isElement(arg)||arg===window||arg===document})[0];if(elem){var listener=loopWith(handler);return elem.style&&(elem.style.pointerEvents="auto"),bindToDomElement(elem,name,listener)}return getHandlers(name).push(handler),function(){var handlers=getHandlers(name);handlers.splice(handlers.indexOf(handler),1)}},eloop.bindOnce=function(){var args=Array.prototype.slice.call(arguments,0),handler=getHandlerFromArgs(args);args.splice(args.indexOf(handler),1,function(e){unbind(),handler(e)});var unbind=eloop.bind.apply(this,args);return unbind},eloop.fire=function(event){event="string"==typeof event?{type:event}:event,mainLoop(event)};var interceptors=listeners(),exitListeners=listeners();eloop.addInterceptor=interceptors.addListener,eloop.addExitListener=exitListeners.addListener;var mainLoop=loopWith(function(e){getHandlers(e.type).slice(0).some(function(handler){return handler(e),e.gridStopBubbling?!0:void 0})});return eloop.bind("grid-destroy",function(){unbindAll(),eloop.destroyed=!0}),eloop.stopBubbling=function(e){return e.gridStopBubbling=!0,e},eloop};eventLoop.EVENTS=EVENTS,eventLoop.GRID_EVENTS=GRID_EVENTS,module.exports=eventLoop},{"../listeners":30,"../mousewheel":31,"../util":42}],29:[function(require,module,exports){module.exports=function(_grid,model){function makeDecorator(col){var decorator=grid.decorators.create(0,col,1,1,"cell","real");return decorator.getDecoratorLeft=function(){var firstRect=decorator.boundingBox&&decorator.boundingBox.getClientRects()&&decorator.boundingBox.getClientRects()[0]||{};return grid.viewPort.toGridX(firstRect.left)||0},api.annotateDecorator&&api.annotateDecorator(decorator),decorator}function ensureDecoratorPerCol(){for(var c=0;c<grid.viewPort.cols;c++)if(!api._decorators[c]){if(api.isNeeded&&!api.isNeeded(c))continue;var decorator=api.makeDecorator(c);api._decorators[c]=decorator,grid.decorators.add(decorator)}}var grid=_grid,api=model||{};return api._decorators={},api.makeDecorator=api.makeDecorator||makeDecorator,grid.eventLoop.bind("grid-viewport-change",function(){ensureDecoratorPerCol()}),ensureDecoratorPerCol(),api}},{}],30:[function(require,module,exports){module.exports=function(){var listeners=[];return{addListener:function(fn){return listeners.push(fn),function(){listeners.splice(listeners.indexOf(fn),1)}},notify:function(e){listeners.forEach(function(listener){listener(e)})}}}},{}],31:[function(require,module,exports){function normalizeWheelEvent(e){var deltaX=api.getDelta(e,!0),deltaY=api.getDelta(e),newEvent=Object.create(e,{deltaY:{value:deltaY},deltaX:{value:deltaX},type:{value:"mousewheel"},target:{value:e.target},currentTarget:{value:e.currentTarget}});return newEvent.preventDefault=function(){newEvent.defaultPrevented=!0,e&&e.preventDefault&&e.preventDefault()},newEvent}var EVENT_NAMES=["mousewheel","wheel","DOMMouseScroll"],api={getDelta:function(event,xaxis){if(event.wheelDelta){var delta=event.wheelDeltaY;return xaxis&&(delta=event.wheelDeltaX),delta}if(event.detail){if(event.axis&&(1===event.axis&&xaxis||2===event.axis&&!xaxis))return-1*event.detail*12}else if(event.deltaX||event.deltaY)return xaxis?-1*event.deltaX:-1*event.deltaY;return 0},bind:function(elem,listener){var normalizedListener=function(e){listener(normalizeWheelEvent(e))};return EVENT_NAMES.forEach(function(name){elem.addEventListener(name,normalizedListener)}),function(){EVENT_NAMES.forEach(function(name){elem.removeEventListener(name,normalizedListener)})}},normalize:normalizeWheelEvent};module.exports=api},{}],32:[function(require,module,exports){var key=require("key"),arrow=key.code.arrow,util=require("../util"),rangeUtil=require("../range-util"),ctrlOrCmd=require("../ctrl-or-cmd");module.exports=function(_grid){function seekNextEdge(newIndex,startedDefined,isForwardEdge,isBackwardEdge,goForward){var isEdgeToSeek;for(isEdgeToSeek=isForwardEdge(newIndex)||!startedDefined?isBackwardEdge:isForwardEdge;void 0!==goForward(newIndex)&&!isEdgeToSeek(newIndex=goForward(newIndex)););return newIndex}function navFrom(row,col,e){var isLeftwardEdge,isRightwardEdge,isUpwardEdge,isDownwardEdge,cellHasValue,startedDefined,newRow=row,newCol=col,isSeek=ctrlOrCmd(e);switch(isSeek&&(cellHasValue=function(r,c){return void 0===r||void 0===c?!1:!!grid.dataModel.get(r,c).formatted},isLeftwardEdge=function(c){return cellHasValue(newRow,c)&&!cellHasValue(newRow,grid.data.left(c))},isRightwardEdge=function(c){return cellHasValue(newRow,c)&&!cellHasValue(newRow,grid.data.right(c))},isUpwardEdge=function(r){return cellHasValue(r,newCol)&&!cellHasValue(grid.data.up(r),newCol)},isDownwardEdge=function(r){return cellHasValue(r,newCol)&&!cellHasValue(grid.data.down(r),newCol)},startedDefined=cellHasValue(newRow,newCol)),e.which){case arrow.down.code:newRow=isSeek?seekNextEdge(newRow,startedDefined,isDownwardEdge,isUpwardEdge,grid.data.down):grid.data.down(newRow);break;case arrow.up.code:newRow=isSeek?seekNextEdge(newRow,startedDefined,isUpwardEdge,isDownwardEdge,grid.data.up):grid.data.up(newRow);break;case arrow.right.code:newCol=isSeek?seekNextEdge(newCol,startedDefined,isRightwardEdge,isLeftwardEdge,grid.data.right):grid.data.right(newCol);break;case arrow.left.code:newCol=isSeek?seekNextEdge(newCol,startedDefined,isLeftwardEdge,isRightwardEdge,grid.data.left):grid.data.left(newCol)}return void 0===newRow&&(newRow=row),void 0===newCol&&(newCol=col),{row:newRow,col:newCol}}function isNavableMouseEvent(e){var target=e.target;return!target||grid.eventIsOnCells(e)&&2!==e.button}function selectFromFocusToCell(fromRow,fromCol,toRow,toCol,ctrlOrCmdPressed,wasSelected){if(wasSelected&&model.checkboxMode){var range=rangeUtil.createFromPoints(fromRow,fromCol,toRow,toCol),prevSelections=findFullRowOrColSelections(range);prevSelections.length&&prevSelections.forEach(function(prevSelection){removeFullRowOrColFromSelection(prevSelection,range)})}else setSelectionFromPoints(fromRow,fromCol,toRow,toCol,ctrlOrCmdPressed)}function createHeaderSelectionRange(row,col){var headerSelectionRange;return 0>row&&0>col?headerSelectionRange=rangeUtil.createFromPoints(0,0,1/0,1/0):0>row?headerSelectionRange=rangeUtil.createFromPoints(0,col,1/0,col):0>col&&(headerSelectionRange=rangeUtil.createFromPoints(row,0,row,1/0)),headerSelectionRange}function addOrSetSelection(selection){selectionIsFocus(model.selection)?model.setSelection(selection):addSelection(selection)}function removeFullRowOrColFromSelection(selection,rowOrCol){if(rowOrCol.width===1/0){var newSelections=[];if(selection.top<rowOrCol.top){var newSelection={top:selection.top,height:rowOrCol.top-selection.top,left:selection.left,width:selection.width};newSelections.push(newSelection)}var bottomRow=selection.top+selection.height-1;bottomRow>rowOrCol.top+rowOrCol.height-1&&newSelections.push({top:rowOrCol.top+rowOrCol.height,height:bottomRow-(rowOrCol.top+rowOrCol.height-1),left:selection.left,width:selection.width}),removeSelection(selection),newSelections.forEach(addOrSetSelection),syncSelectionToHeaders()}rowOrCol.height===1/0}function findFullRowOrColSelections(range){return model.getAllSelections().filter(function(selection){return selection.height===1/0&&0===selection.top&&rangeUtil.intersect([selection.left,selection.width],[range.left,range.width])||selection.width===1/0&&0===selection.left&&rangeUtil.intersect([selection.top,selection.height],[range.top,range.height])})}function addSelection(range){model.otherSelections.push(createAndAddSelectionDecorator(range.top,range.left,range.height,range.width))}function handleRowColSelectionChange(rowOrCol){var decoratorsField="_"+rowOrCol+"SelectionClasses";if(model[decoratorsField].forEach(function(selectionDecorator){grid.cellClasses.remove(selectionDecorator)}),model[decoratorsField]=[],grid[rowOrCol+"Model"].allSelected()){var top="row"===rowOrCol?1/0:0,left="col"===rowOrCol?1/0:0,decorator=grid.cellClasses.create(top,left,"selected",1,1,"virtual");grid.cellClasses.add(decorator),model[decoratorsField].push(decorator)}else grid[rowOrCol+"Model"].getSelected().forEach(function(index){var virtualIndex=grid[rowOrCol+"Model"].toVirtual(index),top="row"===rowOrCol?virtualIndex:0,left="col"===rowOrCol?virtualIndex:0,decorator=grid.cellClasses.create(top,left,"selected",1,1,"virtual");grid.cellClasses.add(decorator),model[decoratorsField].push(decorator)})}function createAndAddSelectionDecorator(){var selection=grid.decorators.create.apply(this,arguments),defaultRender=selection.render;return selection.render=function(){var div=defaultRender();return div.setAttribute("class","grid-selection"),div},grid.decorators.add(selection),selection}function syncSelectionToHeaders(){grid.colModel.clearSelected(!0),grid.rowModel.clearSelected(!0),model.getAllSelections().forEach(function(selection){selection&&maybeSelectHeaderFromSelection(selection)})}function maybeSelectHeaderFromSelection(range,deselect){var indexes;range.height===1/0&&(indexes=grid.data.col.indexes({from:range.left,length:range.width}),deselect?grid.colModel.deselect(indexes):grid.colModel.select(indexes)),range.width===1/0&&(indexes=grid.data.row.indexes({from:range.top,length:range.height}),deselect?grid.rowModel.deselect(indexes):grid.rowModel.select(indexes))}function selectionIsFocus(selection){return 1===selection.height&&1===selection.width&&!model.otherSelections.length}function setSelectionToFocus(){model.setSelection({top:model.focus.row,left:model.focus.col,height:1,width:1})}function clearOtherSelections(){grid.decorators.remove(model.otherSelections),model.otherSelections=[],syncSelectionToHeaders()}function removeSelection(selection){if(rangeUtil.equal(selection,model.selection))if(model.otherSelections.length){var lastSelection=model.otherSelections.pop();grid.decorators.remove(lastSelection),model.setSelection(lastSelection)}else setSelectionToFocus();else{var index=model.otherSelections.indexOf(selection);-1!==index&&(model.otherSelections.splice(index,1),grid.decorators.remove(selection))}syncSelectionToHeaders()}function setSelectionFromPoints(fromRow,fromCol,toRow,toCol,dontClearOthers){dontClearOthers||clearOtherSelections(),toRow=util.clamp(toRow,0,1/0),toCol=util.clamp(toCol,0,1/0);var newSelection=rangeUtil.createFromPoints(fromRow,fromCol,toRow,toCol);model.setSelection(newSelection)}function clearSelectionFromModelChange(e){"size"!==e.action&&model.clearSelection()}var grid=_grid,model={focus:{row:0,col:0}};model.otherSelections=[];var focusClass=grid.cellClasses.create(0,0,"focus");grid.cellClasses.add(focusClass),model.focusDecorator=grid.decorators.create(0,0,1,1);var focusDefaultRender=model.focusDecorator.render;model.focusDecorator.render=function(){var div=focusDefaultRender();return div.setAttribute("class","grid-focus-decorator"),div},grid.decorators.add(model.focusDecorator),model.setFocus=function(row,col,dontClearSelection,dontSetSelection){row=grid.data.row.clamp(row),("number"!=typeof row||isNaN(row))&&(row=model.focus.row),col=grid.data.col.clamp(col),("number"!=typeof col||isNaN(col))&&(col=model.focus.col);var changed=row!==model.focus.row||col!==model.focus.col;model.focus.row=row,model.focus.col=col,focusClass.top=row,focusClass.left=col,model.focusDecorator.top=row,model.focusDecorator.left=col,grid.cellScrollModel.scrollIntoView(row,col),dontClearSelection||clearOtherSelections(),dontSetSelection||setSelectionToFocus(),changed&&grid.eventLoop.fire("grid-focus-change")},model._navFrom=navFrom,model.handleTabEvent=function(e){var newCol=model.focus.col,newRow=model.focus.row;e&&e.shiftKey?0===newCol?(newRow=grid.data.up(newRow),newCol=grid.data.col.count()-1):newCol=grid.data.left(newCol):newCol===grid.data.col.count()-1?(newRow=grid.data.down(newRow),newCol=0):newCol=grid.data.right(newCol),model.setFocus(newRow,newCol),e.preventDefault()},grid.eventLoop.bind("keydown",function(e){if(grid.focused){if(key.is(key.code.special.tab,e.which))return void model.handleTabEvent(e);if(key.is(arrow,e.which))if(e.shiftKey){var newSelection;newSelection=-1===model.selection.top?{top:model.focus.row,left:model.focus.col,height:1,width:1}:{top:model.selection.top,left:model.selection.left,height:model.selection.height,width:model.selection.width};var navFromRow,navFromCol;navFromRow=model.focus.row===newSelection.top?newSelection.top+newSelection.height-1:newSelection.top,navFromCol=model.focus.col===newSelection.left?newSelection.left+newSelection.width-1:newSelection.left;var newRowCol=navFrom(navFromRow,navFromCol,e);setSelectionFromPoints(model.focus.row,model.focus.col,newRowCol.row,newRowCol.col),grid.cellScrollModel.scrollIntoView(newRowCol.row,newRowCol.col)}else{var newFocus=navFrom(model.focus.row,model.focus.col,e);model.setFocus(newFocus.row,newFocus.col,e)}}}),grid.eventLoop.bind("mousedown",function(e){if(isNavableMouseEvent(e)){var row=e.row,col=e.col,ctrlOrCmdPressed=model.checkboxMode&&(0>row||0>col)||ctrlOrCmd(e);if(e.shiftKey){var wasSelected,fromRow=model.focus.row,fromCol=model.focus.col,toRow=row,toCol=col;0>toRow&&(wasSelected=grid.data.col.get(toCol).selected,fromRow=0,toRow=1/0),0>toCol&&(wasSelected=grid.data.row.get(toRow).selected,fromCol=0,toCol=1/0),selectFromFocusToCell(fromRow,fromCol,toRow,toCol,ctrlOrCmdPressed,wasSelected)}else{var focusRow=row;0>focusRow&&(focusRow=grid.view.row.toData(grid.rowModel.numHeaders()));var focusCol=col;0>focusCol&&(focusCol=grid.view.col.toData(grid.colModel.numHeaders()));var headerSelectionRange=createHeaderSelectionRange(row,col);if(headerSelectionRange){var prevSelections=findFullRowOrColSelections(headerSelectionRange);if(prevSelections.length&&model.checkboxMode){var selectAll=headerSelectionRange.width===1/0&&headerSelectionRange.height===1/0&&!(grid.rowModel.allSelected()||grid.colModel.allSelected());prevSelections.forEach(function(prevSelection){removeFullRowOrColFromSelection(prevSelection,headerSelectionRange)}),selectAll&&model.setSelection(headerSelectionRange),model.setFocus(focusRow,focusCol,!0,!0)}else ctrlOrCmdPressed&&!selectionIsFocus(model.selection)?addSelection(model.selection):clearOtherSelections(),model.setFocus(focusRow,focusCol,ctrlOrCmdPressed),model.setSelection(headerSelectionRange)}else ctrlOrCmdPressed&&addSelection(model.selection),model.setFocus(focusRow,focusCol,ctrlOrCmdPressed)}}}),model._rowSelectionClasses=[],model._colSelectionClasses=[],grid.eventLoop.bind("grid-row-selection-change",function(){handleRowColSelectionChange("row")}),grid.eventLoop.bind("grid-col-selection-change",function(){handleRowColSelectionChange("col")});var selection=createAndAddSelectionDecorator();return model.getAllSelections=function(){var selections=[];return model.selection&&selections.push(model.selection),selections.concat(model.otherSelections)},model.setSelection=function(newSelection){var height=newSelection.height,width=newSelection.width;selectionIsFocus(newSelection)&&(height=-1,width=-1),selection.top=newSelection.top,selection.left=newSelection.left,selection.height=height,selection.width=width,syncSelectionToHeaders()},selection._onDragStart=function(e){if(isNavableMouseEvent(e)){e.enableAutoScroll&&e.enableAutoScroll();var wasSelected,toRow,toCol,fromRow=model.focus.row,fromCol=model.focus.col,startCol=e.col,startRow=e.row;0>startRow&&(wasSelected=!grid.data.col.get(startCol).selected,fromRow=0,toRow=1/0),0>startCol&&(wasSelected=!grid.data.row.get(startRow).selected,fromCol=0,toCol=1/0);var unbindDrag=grid.eventLoop.bind("grid-cell-drag",function(e){toRow=toRow!==1/0?e.row:toRow,toCol=toCol!==1/0?e.col:toCol;var fixedRows=grid.rowModel.numFixed(!0);fixedRows>startRow&&toRow>fixedRows&&toRow!==1/0&&(startRow=toRow=grid.rowModel.numFixed(),grid.cellScrollModel.scrollTo(0,grid.cellScrollModel.col));var fixedCols=grid.colModel.numFixed(!0);fixedCols>startCol&&toCol>fixedCols&&toCol!==1/0&&(startCol=toCol=grid.colModel.numFixed(),grid.cellScrollModel.scrollTo(grid.cellScrollModel.row,0)),isNaN(toRow)||isNaN(toCol)||selectFromFocusToCell(fromRow,fromCol,toRow,toCol,!0,wasSelected)}),unbindDragEnd=grid.eventLoop.bind("grid-drag-end",function(){unbindDrag(),unbindDragEnd()})}},grid.eventLoop.bind("grid-drag-start",selection._onDragStart),setSelectionToFocus(),model._selectionDecorator=selection,Object.defineProperty(model,"selection",{get:function(){return-1===selection.height?{top:model.focus.row,left:model.focus.col,height:1,width:1}:selection}}),model.getAllSelectedRanges=function(){var selectionRange=grid.navigationModel.selection;return-1===selectionRange.top&&(selectionRange={top:grid.navigationModel.focus.row,left:grid.navigationModel.focus.col,width:1,height:1}),[selectionRange].concat(model.otherSelections)},model.clearSelection=function(){clearOtherSelections(),setSelectionToFocus()},grid.eventLoop.bind("grid-col-change",clearSelectionFromModelChange),grid.eventLoop.bind("grid-row-change",clearSelectionFromModelChange),model}},{"../ctrl-or-cmd":23,"../range-util":37,"../util":42,key:9}],33:[function(require,module,exports){module.exports=function(){}},{}],34:[function(require,module,exports){module.exports=function(){return arguments[0]}},{}],35:[function(require,module,exports){var util=require("../util"),debounce=require("../debounce"),capitalize=require("capitalize");module.exports=function(_grid){function cacheMaxScroll(){model.maxScroll.height=getMaxScroll("height"),model.maxScroll.width=getMaxScroll("width")}function notifyListeners(){grid.eventLoop.fire("grid-pixel-scroll");var scrollTop=model.top,row=grid.virtualPixelCellModel.getRow(scrollTop+grid.virtualPixelCellModel.fixedHeight())-grid.rowModel.numFixed(),scrollLeft=model.left,col=grid.virtualPixelCellModel.getCol(scrollLeft+grid.virtualPixelCellModel.fixedWidth())-grid.colModel.numFixed();grid.cellScrollModel.scrollTo(row,col,void 0,!0)}function getScrollPositionFromReal(scrollBarRealClickCoord,heightWidth,vertHorz){var scrollBarTopClick=scrollBarRealClickCoord-grid.virtualPixelCellModel["fixed"+capitalize(heightWidth)](),scrollRatio=scrollBarTopClick/getMaxScrollBarCoord(heightWidth,vertHorz),scrollCoord=scrollRatio*model.maxScroll[heightWidth];return scrollCoord}function makeScrollBarDecorator(isHorz){var decorator=grid.decorators.create(),xOrY=isHorz?"X":"Y",heightWidth=isHorz?"width":"height",vertHorz=isHorz?"horz":"vert",gridCoordField="grid"+xOrY,layerCoordField="layer"+xOrY,viewPortClampFn=grid.viewPort["clamp"+xOrY];return decorator.postRender=function(scrollBarElem){return scrollBarElem.setAttribute("class","grid-scroll-bar"),decorator._onDragStart=function(e){if(e.target===scrollBarElem){var scrollBarOffset=e[layerCoordField];decorator._unbindDrag=grid.eventLoop.bind("grid-drag",function(e){grid.eventLoop.stopBubbling(e);var gridCoord=viewPortClampFn(e[gridCoordField]),scrollBarRealClickCoord=gridCoord-scrollBarOffset,scrollCoord=getScrollPositionFromReal(scrollBarRealClickCoord,heightWidth,vertHorz);isHorz?model.scrollTo(model.top,scrollCoord):model.scrollTo(scrollCoord,model.left)}),decorator._unbindDragEnd=grid.eventLoop.bind("grid-drag-end",function(){decorator._unbindDrag(),decorator._unbindDragEnd()}),e.stopPropagation()}},grid.eventLoop.bind("grid-drag-start",scrollBarElem,decorator._onDragStart),grid.eventLoop.bind("mousedown",scrollBarElem,function(e){grid.eventLoop.stopBubbling(e)}),scrollBarElem},decorator.units="px",decorator.space="real",decorator}function getMaxScroll(heightWidth){if(model.maxIsAllTheWayFor[heightWidth])return model[heightWidth]-1;for(var rowOrCol="height"===heightWidth?"row":"col",scrollLength=model[heightWidth],viewScrollHeightOrWidth=getViewScrollHeightOrWidth(heightWidth),firstScrollableCell=grid[rowOrCol+"Model"].numFixed();scrollLength>viewScrollHeightOrWidth-10;)scrollLength-=grid.virtualPixelCellModel[heightWidth](firstScrollableCell),-firstScrollableCell++;return model[heightWidth]-scrollLength}function getScrollRatioFromVirtualScrollCoords(scroll,heightWidth){var maxScroll=model.maxScroll[heightWidth],scrollRatio=scroll/maxScroll;return scrollRatio}function getMaxScrollBarCoord(heightWidth,vertHorz){return getViewScrollHeightOrWidth(heightWidth)-model[vertHorz+"ScrollBar"][heightWidth]}function getRealScrollBarPosition(scroll,heightWidth,vertHorz){var scrollRatio=getScrollRatioFromVirtualScrollCoords(scroll,heightWidth),maxScrollBarScroll=getMaxScrollBarCoord(heightWidth,vertHorz),scrollBarCoord=scrollRatio*maxScrollBarScroll;

return scrollBarCoord+grid.virtualPixelCellModel["fixed"+capitalize(heightWidth)]()}function calcScrollBarRealTop(){return getRealScrollBarPosition(model.top,"height","vert")}function calcScrollBarRealLeft(){return getRealScrollBarPosition(model.left,"width","horz")}function positionScrollBars(){model.vertScrollBar.top=calcScrollBarRealTop(),model.horzScrollBar.left=calcScrollBarRealLeft()}function getViewScrollHeightOrWidth(heightWidth){return grid.viewPort[heightWidth]-grid.virtualPixelCellModel["fixed"+capitalize(heightWidth)]()}function getScrollableViewWidth(){return getViewScrollHeightOrWidth("width")}function getScrollableViewHeight(){return getViewScrollHeightOrWidth("height")}function sizeScrollBars(){model.vertScrollBar.left=grid.viewPort.width-scrollBarWidth,model.horzScrollBar.top=grid.viewPort.height-scrollBarWidth;var scrollableViewHeight=getScrollableViewHeight(),scrollableViewWidth=getScrollableViewWidth();model.vertScrollBar.height=Math.max(scrollableViewHeight/grid.virtualPixelCellModel.totalHeight()*scrollableViewHeight,20),model.horzScrollBar.width=Math.max(scrollableViewWidth/grid.virtualPixelCellModel.totalWidth()*scrollableViewWidth,20),model.vertScrollBar.height>=scrollableViewHeight&&(model.vertScrollBar.height=-1),model.horzScrollBar.width>=scrollableViewWidth&&(model.horzScrollBar.width=-1),positionScrollBars()}function getScrollParent(elem,stopParent){if(stopParent=stopParent||document,!elem)return stopParent;for(var position=elem.style.position,excludeStaticParent="absolute"===position,overflowRegex=/(auto|scroll)/,scrollParent=elem;(scrollParent=scrollParent.parentElement)&&scrollParent!==stopParent;)if(!excludeStaticParent||"static"!==scrollParent.style.position){var computedStyle=getComputedStyle(scrollParent);if(overflowRegex.test(computedStyle.overflow+computedStyle.overflowY+computedStyle.overflowX))break}return"fixed"!==position&&scrollParent&&scrollParent!==elem?scrollParent:elem.ownerDocument||stopParent}var grid=_grid,model={top:0,left:0,maxScroll:{},maxIsAllTheWayFor:{height:!1,width:!1}},scrollBarWidth=10;grid.eventLoop.bind("grid-virtual-pixel-cell-change",function(){var scrollHeight=grid.virtualPixelCellModel.totalHeight()-grid.virtualPixelCellModel.fixedHeight(),scrollWidth=grid.virtualPixelCellModel.totalWidth()-grid.virtualPixelCellModel.fixedWidth();model.setScrollSize(scrollHeight,scrollWidth),cacheMaxScroll(),sizeScrollBars()}),grid.eventLoop.bind("grid-viewport-change",function(){cacheMaxScroll(),sizeScrollBars()}),grid.eventLoop.bind("mousewheel",function(e){if(getScrollParent(e.target,grid.container)===grid.container){var deltaY=e.deltaY,deltaX=e.deltaX;model.scrollTo(model.top-deltaY,model.left-deltaX,!0),e.preventDefault(),debouncedNotify()}}),model.setScrollSize=function(h,w){model.height=h,model.width=w};var debouncedNotify=debounce(notifyListeners,1);return model.scrollTo=function(top,left,dontNotify){model.top=util.clamp(top,0,model.maxScroll.height),model.left=util.clamp(left,0,model.maxScroll.width),positionScrollBars(),dontNotify||notifyListeners()},model.vertScrollBar=makeScrollBarDecorator(),model.horzScrollBar=makeScrollBarDecorator(!0),model.vertScrollBar.width=scrollBarWidth,model.horzScrollBar.height=scrollBarWidth,model._getMaxScroll=getMaxScroll,model._getRealScrollBarPosition=getRealScrollBarPosition,model._getScrollPositionFromReal=getScrollPositionFromReal,grid.decorators.add(model.vertScrollBar),grid.decorators.add(model.horzScrollBar),model}},{"../debounce":25,"../util":42,capitalize:2}],36:[function(require,module,exports){var addDirtyProps=require("../add-dirty-props");module.exports=function(range,dirtyClean,parentDirtyClean,propOpts){range=range||{},range.isDirty=dirtyClean.isDirty;var watchedProperties=["top","left","height","width","units","space"];propOpts&&(watchedProperties=watchedProperties.map(function(propName){return{name:propName,onDirty:propOpts.onDirty,preDirty:propOpts.preDirty}}));var dirtyCleans=[dirtyClean];return parentDirtyClean&&dirtyCleans.push(parentDirtyClean),addDirtyProps(range,watchedProperties,dirtyCleans),range.units="cell",range.space="data",range}},{"../add-dirty-props":12}],37:[function(require,module,exports){module.exports={intersect:function(range1,range2){var range2Start=range2[0],range1Start=range1[0],range1End=range1Start+range1[1]-1,range2End=range2Start+range2[1]-1;if(range2Start>range1End||range1Start>range2End)return null;var resultStart=range1Start>range2Start?range1Start:range2Start,resultEnd=range2End>range1End?range1End:range2End;return[resultStart,resultEnd-resultStart+1]},union:function(range1,range2){if(!range1)return range2;if(!range2)return range1;var range2Start=range2[0],range2End=range2Start+range2[1]-1,range1Start=range1[0],range1End=range1Start+range1[1]-1,resultStart=range2Start>range1Start?range1Start:range2Start;return[resultStart,(range1End>range2End?range1End:range2End)-resultStart+1]},createFromPoints:function(r1,c1,r2,c2){var range={};return r2>r1?(range.top=r1,range.height=r2-r1+1):(range.top=r2,range.height=r1-r2+1),c2>c1?(range.left=c1,range.width=c2-c1+1):(range.left=c2,range.width=c1-c2+1),range},iterate:function(){for(var args=this.getArgs(arguments),range=args.range,cellFn=args.cellFn,rowFn=args.rowFn,r=range.top;r<range.top+range.height;r++){var rowResult;rowFn&&(rowResult=rowFn(r));for(var c=range.left;c<range.left+range.width;c++)cellFn&&cellFn(r,c,rowResult)}},getArgs:function(args){var cellFn,rowFn,range=args[0];return 2===args.length?cellFn=args[1]:3===args.length&&(cellFn=args[2],rowFn=args[1]),{range:range,cellFn:cellFn,rowFn:rowFn}},equal:function(r1,r2){return r1.top===r2.top&&r1.left===r2.left&&r1.width===r2.width&&r1.height===r2.height}}},{}],38:[function(require,module,exports){module.exports=function(_grid){var grid=_grid,api=require("../abstract-row-col-model")(grid,"row","height",30);return api}},{"../abstract-row-col-model":11}],39:[function(require,module,exports){module.exports=function(_grid){function setColShowing(col){grid.colModel.get(col).hidden=!1}function doWhileHidden(col,fn){for(;grid.colModel.get(col-1).hidden;)col--,fn&&fn(col);return col}function createDecorator(col,right){var headerDecorator=grid.decorators.create(0,col,1,1,"cell","virtual");return headerDecorator.postRender=function(div){right?(div.style.transform="translate(50%, -50%)",div.style.webkitTransform="translate(50%, -50%)",div.style.removeProperty("left")):(div.style.transform="translate(-50%, -50%)",div.style.webkitTransform="translate(-50%, -50%)",div.style.removeProperty("right")),div.style.removeProperty("bottom"),div.style.top="50%",div.setAttribute("class","show-hidden-cols"),div.setAttribute("dts","grid_column_unhide_btn"),grid.eventLoop.bind("click",div,function(){doWhileHidden(col,setColShowing)})},headerDecorator}function maybeRemoveDecorator(col){if(api._decorators[col]){var decorator=api._decorators[col];grid.decorators.remove(decorator),api._decorators[col]=void 0}}var grid=_grid,api={_decorators:{}};return grid.eventLoop.bind("grid-col-change",function(e){("hide"===e.action||"add"===e.action)&&e.descriptors.forEach(function(descriptor){var col=descriptor.index;if(col||0===col)if(descriptor.hidden){var decCol=col+1,rightSide=col===grid.colModel.length(!0)-1;if(rightSide){var lastHiddenCol=doWhileHidden(col);decCol=lastHiddenCol-1}maybeRemoveDecorator(col);var decorator=createDecorator(decCol,rightSide);grid.decorators.add(decorator),api._decorators[col]=decorator}else maybeRemoveDecorator(col)})}),api}},{}],40:[function(require,module,exports){var util=require("../util");module.exports=function(_grid){var sortedCol,ascending,grid=_grid,cellData=[],headerData=[],dirtyClean=require("../dirty-clean")(grid),internalSet=function(data,r,c,datum){data[r]||(data[r]=[]),data[r][c]=datum,dirtyClean.setDirty()},api={isDirty:dirtyClean.isDirty,set:function(r,c,datum){var data=arguments[0];util.isArray(data)||("string"==typeof datum&&(datum={value:datum.replace("[rR]","").replace("[cC]","").split(" ")}),data=[{row:r,col:c,data:datum}]),data.forEach(function(change){internalSet(cellData,change.row,change.col,change.data)})},setHeader:function(r,c,datum){internalSet(headerData,r,c,datum)},get:function(r,c){var rowDescriptor=grid.rowModel.row(r);if(!rowDescriptor)return{formatted:""};var dataRow=cellData[rowDescriptor.dataRow],datum=dataRow&&dataRow[grid.colModel.col(c).dataCol],value=datum&&datum.value;return void 0===value&&console.log(value&&"r"+value[0]+" c"+value[1]||""),{value:value,formatted:value&&(rowDescriptor.dataLayer?" s"+rowDescriptor.dataLayer+" ":"")+"r"+value[0]+" c"+value[1]||""}},getCopyData:function(r,c){return api.get(r,c).formatted},getHeader:function(r,c){var dataRow=headerData[grid.rowModel.get(r).dataRow],datum=dataRow&&dataRow[grid.colModel.get(c).dataCol],value=datum&&datum.value;return{value:value,formatted:value&&"hr"+value[0]+" hc"+value[1]||""}},toggleSort:function(c){var retVal=-1,compareMethod=function(val1,val2){return val2>val1?retVal:-1*retVal};c===sortedCol?(ascending&&(retVal=1),ascending=!ascending):(sortedCol=c,ascending=!0),cellData.sort(function(dataRow1,dataRow2){return dataRow1&&dataRow1[c]?dataRow2&&dataRow2[c]?compareMethod(dataRow1[c].value,dataRow2[c].value):-1*retVal:retVal}),dirtyClean.setDirty()}};return api}},{"../dirty-clean":27,"../util":42}],41:[function(require,module,exports){function DSVToArray(strData,strDelimiter){strDelimiter=strDelimiter||",";for(var objPattern=new RegExp("(\\"+strDelimiter+'|\\r?\\n|\\r|^)(?:"([^"]*(?:""[^"]*)*)"|([^"\\'+strDelimiter+"\\r\\n]+))","gi"),arrData=[[]],arrMatches=null;arrMatches=objPattern.exec(strData);){var strMatchedDelimiter=arrMatches[1];strMatchedDelimiter.length&&strMatchedDelimiter!==strDelimiter&&arrData.push([]);var strMatchedValue;strMatchedValue=arrMatches[2]?arrMatches[2].replace(new RegExp('""',"g"),'"'):arrMatches[3],arrData[arrData.length-1].push(strMatchedValue)}return(arrData[0].length||!strData)&&arrData||[[strData]]}module.exports.stringify=function(data){var string="";return data.forEach(function(row,r){row.forEach(function(value,c){(-1!==value.indexOf("\n")||-1!==value.indexOf("	")||-1!==value.indexOf('"'))&&(value='"'+value.replace(/"/g,'""')+'"'),string+=value,c!==row.length-1&&(string+="	")}),r!==data.length-1&&(string+="\n")}),string},module.exports.parse=function(string){return DSVToArray(string,"	")}},{}],42:[function(require,module,exports){module.exports={clamp:function(num,min,max,returnNaN){return num>max?returnNaN?0/0:max:min>num?returnNaN?0/0:min:num},isNumber:function(number){return"number"==typeof number&&!isNaN(number)},isElement:function(node){return!(!node||!(node.nodeName||node.prop&&node.attr&&node.find))},isArray:function(value){return"[object Array]"===Object.prototype.toString.call(value)},position:function(elem,t,l,b,r){null!=t&&(elem.style.top=t+"px"),null!=t&&(elem.style.left=l+"px"),null!=t&&(elem.style.bottom=b+"px"),null!=t&&(elem.style.right=r+"px"),elem.style.position="absolute"}}},{}],43:[function(require,module,exports){var customEvent=require("../custom-event"),debounce=require("../debounce"),util=require("../util");module.exports=function(_grid){function measureBorderWidth(){if(!borderWidth){var jsGridCell=cells[0]&&cells[0][0];if(jsGridCell){var oldClass=jsGridCell.className;jsGridCell.className=CELL_CLASS;var computedStyle=getComputedStyle(jsGridCell),borderWidthProp=computedStyle.getPropertyValue("border-left-width");borderWidth=parseInt(borderWidthProp),jsGridCell.className=oldClass}return borderWidth=isNaN(borderWidth)||!borderWidth?void 0:borderWidth}}function getBorderWidth(){return borderWidth||1}function buildDivCell(){var cell=document.createElement("div");cell.setAttribute("dts","grid-cell");var style=cell.style;return style.position="absolute",style.boxSizing="border-box",style.top="0px",style.bottom="0px",cell}function destroyRenderedElems(oldElems){oldElems&&oldElems.forEach(function(oldElem){if(oldElem){var destroyEvent=customEvent("grid-rendered-elem-destroy",!0);oldElem.dispatchEvent(destroyEvent)}})}function setPosition(boundingBox,top,left,height,width){var style=boundingBox.style;return 0>=height||0>=width?void(style.display="none"):(style.display="",style.top=top+"px",style.left=left+"px",style.height=height+"px",style.width=width+"px",void(style.position="absolute"))}function positionDecorator(bounding,t,l,h,w){setPosition(bounding,t,l,util.clamp(h,0,grid.viewPort.height),util.clamp(w,0,grid.viewPort.width))}function positionCellDecoratorFromViewCellRange(realCellRange,boundingBox){var realPxRange=grid.viewPort.toPx(realCellRange);positionDecorator(boundingBox,realPxRange.top,realPxRange.left,realPxRange.height&&realPxRange.height+getBorderWidth(),realPxRange.width&&realPxRange.width+getBorderWidth())}function createRangeForDescriptor(descriptor){var range={top:descriptor.top,left:descriptor.left,height:descriptor.height,width:descriptor.width};return"data"===descriptor.space&&"cell"===descriptor.units&&(range.top+=grid.rowModel.numHeaders(),range.left+=grid.colModel.numHeaders()),range}function removeDecorators(decorators){decorators.forEach(function(decorator){var boundingBox=decorator.boundingBox;if(boundingBox){var renderedElement=boundingBox.firstChild;if(renderedElement){var destroyEvent=customEvent("decorator-destroy",!0);renderedElement.dispatchEvent(destroyEvent)}decoratorContainer.removeChild(boundingBox),decorator.boundingBox=void 0}})}function destroyPreviouslyBuilt(built){built&&Object.keys(built).forEach(function(key){destroyRenderedElems(built[key])})}function cleanup(){if(removeDecorators(grid.decorators.getAlive().concat(grid.decorators.popAllDead())),destroyPreviouslyBuilt(builtCols),destroyPreviouslyBuilt(builtRows),container)for(var querySelectorAll=container.querySelectorAll("."+GRID_VIEW_ROOT_CLASS),i=0;i<querySelectorAll.length;++i){var root=querySelectorAll[i];container.removeChild(root)}}var container,root,cellContainer,decoratorContainer,borderWidth,cells,rows,builtCols,builtRows,viewLayer={},grid=_grid,GRID_CELL_CONTAINER_BASE_CLASS="grid-cells",GRID_VIEW_ROOT_CLASS="js-grid-view-root",CELL_CLASS="grid-cell";grid.cellClasses.add(grid.cellClasses.create(0,0,CELL_CLASS,1/0,1/0,"virtual"));var rowHeaderClasses=grid.cellClasses.create(0,0,"grid-header grid-row-header",1/0,0,"virtual"),colHeaderClasses=grid.cellClasses.create(0,0,"grid-header grid-col-header",0,1/0,"virtual"),fixedColClasses=grid.cellClasses.create(0,-1,"grid-last-fixed-col",1/0,1,"virtual"),fixedRowClasses=grid.cellClasses.create(-1,0,"grid-last-fixed-row",1,1/0,"virtual");return grid.cellClasses.add(rowHeaderClasses),grid.cellClasses.add(colHeaderClasses),grid.cellClasses.add(fixedRowClasses),grid.cellClasses.add(fixedColClasses),grid.eventLoop.bind("grid-col-change",function(){fixedColClasses.left=grid.colModel.numFixed()-1,rowHeaderClasses.width=grid.colModel.numHeaders()}),grid.eventLoop.bind("grid-row-change",function(){fixedRowClasses.top=grid.rowModel.numFixed()-1,colHeaderClasses.height=grid.rowModel.numHeaders()}),viewLayer.build=function(elem){cleanup(),container=elem,cellContainer=document.createElement("div"),cellContainer.setAttribute("dts","grid-cells"),cellContainer.setAttribute("class",GRID_CELL_CONTAINER_BASE_CLASS),util.position(cellContainer,0,0,0,0),cellContainer.style.zIndex=0,decoratorContainer=document.createElement("div"),decoratorContainer.setAttribute("dts","grid-decorators"),util.position(decoratorContainer,0,0,0,0),decoratorContainer.style.zIndex=0,decoratorContainer.style.pointerEvents="none",root=document.createElement("div"),root.setAttribute("class",GRID_VIEW_ROOT_CLASS),root.appendChild(cellContainer),root.appendChild(decoratorContainer),container.appendChild(root)},viewLayer.draw=debounce(function(){viewLayer._draw()},1),viewLayer._draw=function(){if(container){var rebuilt=grid.viewPort.isDirty();rebuilt&&viewLayer._buildCells(cellContainer);var builtColsDirty=grid.colModel.areBuildersDirty();(rebuilt||builtColsDirty)&&viewLayer._buildCols();var builtRowsDirty=grid.rowModel.areBuildersDirty();(rebuilt||builtRowsDirty)&&viewLayer._buildRows();var cellsPositionOrSizeChanged=grid.colModel.isDirty()||grid.rowModel.isDirty()||grid.cellScrollModel.isDirty();(grid.cellClasses.isDirty()||rebuilt||cellsPositionOrSizeChanged)&&viewLayer._drawCellClasses(),(rebuilt||cellsPositionOrSizeChanged||builtColsDirty||builtRowsDirty||grid.dataModel.isDirty())&&viewLayer._drawCells(),(grid.decorators.isDirty()||rebuilt||cellsPositionOrSizeChanged)&&viewLayer._drawDecorators(cellsPositionOrSizeChanged),grid.eventLoop.fire("grid-draw")}},viewLayer._drawCells=function(){measureBorderWidth();var lastVirtualCol,lastVirtualRow,bWidth=getBorderWidth(),headerRows=grid.rowModel.numHeaders(),headerCols=grid.colModel.numHeaders(),totalVisibleCellWidth=0,widths=[],lefts=[],virtualCols=[];grid.viewPort.iterateCells(function(r,c){var cell=cells[r][c],width=widths[c]||(widths[c]=grid.viewPort.getColWidth(c)),virtualCol=virtualCols[c]||(virtualCols[c]=grid.viewPort.toVirtualCol(c));if(0===width||virtualCol===lastVirtualCol)return void(cell.style.display="none");0===r&&(totalVisibleCellWidth+=width),lastVirtualCol=virtualCol,cell.style.display="",cell.style.width=width+bWidth+"px";var left=lefts[c]||(lefts[c]=grid.viewPort.getColLeft(c));cell.style.left=left+"px";var data,virtualRow=grid.viewPort.toVirtualRow(r);data=headerRows>r||headerCols>c?grid.dataModel.getHeader(virtualRow,virtualCol):grid.dataModel.get(grid.rowModel.toData(virtualRow),grid.colModel.toData(virtualCol));var builder=headerRows>virtualRow&&grid.rowModel.get(virtualRow).builder||void 0,hasRowBuilder=!0;builder||(hasRowBuilder=!1,builder=grid.colModel.get(virtualCol).builder);var cellChild;if(builder){var builtElem;builtElem=hasRowBuilder?builtRows[virtualRow][c]:builtCols[virtualCol][r],cellChild=builder.update(builtElem,{virtualCol:virtualCol,virtualRow:virtualRow,data:data})}if(cellChild){var notSameElem=cell.firstChild!==cellChild;cell.firstChild&&notSameElem&&cell.removeChild(cell.firstChild),notSameElem&&cell.appendChild(cellChild)}else viewLayer.setTextContent(cell,data.formatted)},function(r){var height=grid.viewPort.getRowHeight(r),row=rows[r],virtualRow=grid.view.row.toVirtual(r);if(0===height||lastVirtualRow===virtualRow)return void(row.style.display="none");lastVirtualRow=virtualRow,row.style.display="",row.style.height=height+bWidth+"px";var top=grid.viewPort.getRowTop(r);row.style.top=top+"px"}),rows.forEach(function(row){row.style.width=totalVisibleCellWidth+"px"}),cellContainer.className=grid.cellScrollModel.row%2?GRID_CELL_CONTAINER_BASE_CLASS+" odds":GRID_CELL_CONTAINER_BASE_CLASS},viewLayer._buildCells=function(cellContainer){for(;cellContainer.firstChild;)cellContainer.removeChild(cellContainer.firstChild);cells=[],rows=[];var row;grid.viewPort.iterateCells(function(r,c){var cell=buildDivCell();cells[r][c]=cell,row.appendChild(cell)},function(r){cells[r]=[],row=document.createElement("div"),row.setAttribute("class","grid-row"),row.setAttribute("dts","grid-row"),row.style.position="absolute",row.style.left=0,rows[r]=row,cellContainer.appendChild(row)})},viewLayer._buildCols=function(){var previouslyBuiltCols=builtCols;builtCols={};for(var c=0;c<grid.colModel.length(!0);c++){var builder=grid.colModel.get(c).builder,oldElems=previouslyBuiltCols&&previouslyBuiltCols[c];if(builder){builtCols[c]=[],destroyRenderedElems(oldElems);for(var realRow=0;realRow<grid.viewPort.rows;realRow++)builtCols[c][realRow]=builder.render({viewRow:realRow,previousElement:oldElems&&oldElems[realRow]})}}},viewLayer._buildRows=function(){var previouslyBuiltRows=builtRows;builtRows={};for(var r=0;r<grid.rowModel.numHeaders();r++){var builder=grid.rowModel.get(r).builder,oldElems=previouslyBuiltRows&&previouslyBuiltRows[r];if(builder){builtRows[r]=[],destroyRenderedElems(oldElems);for(var realCol=0;realCol<grid.viewPort.cols;realCol++)builtRows[r][realCol]=builder.render({viewCol:realCol,previousElement:oldElems&&oldElems[realCol]})}}},viewLayer._drawDecorators=function(cellsPositionOrSizeChanged){var aliveDecorators=grid.decorators.getAlive();aliveDecorators.forEach(function(decorator){var boundingBox=decorator.boundingBox;if(!boundingBox){boundingBox=document.createElement("div"),boundingBox.style.pointerEvents="none",decorator.boundingBox=boundingBox;var decElement=decorator.render();decElement&&(boundingBox.appendChild(decElement),decoratorContainer.appendChild(boundingBox))}if(decorator.isDirty()||cellsPositionOrSizeChanged)if("real"===decorator.space)switch(decorator.units){case"px":positionDecorator(boundingBox,decorator.top,decorator.left,decorator.height,decorator.width);break;case"cell":positionCellDecoratorFromViewCellRange(decorator,boundingBox)}else if("virtual"===decorator.space||"data"===decorator.space)switch(decorator.units){case"px":break;case"cell":default:var range=createRangeForDescriptor(decorator),realCellRange=grid.viewPort.intersect(range);realCellRange?positionCellDecoratorFromViewCellRange(realCellRange,boundingBox):positionDecorator(boundingBox,-1,-1,-1,-1)}}),removeDecorators(grid.decorators.popAllDead())},viewLayer._drawCellClasses=function(){grid.viewPort.iterateCells(function(r,c){var classes=grid.cellClasses.getCachedClasses(grid.view.row.toVirtual(r),grid.view.col.toVirtual(c));cells[r][c].className=classes.join(" ")})},viewLayer.setTextContent=function(elem,text){elem.firstChild&&3===elem.firstChild.nodeType?elem.firstChild.nodeValue=text:elem.textContent=text},grid.eventLoop.bind("grid-destroy",function(){cleanup(),clearTimeout(viewLayer.draw.timeout),viewLayer.draw=require("../no-op")}),viewLayer}},{"../custom-event":24,"../debounce":25,"../no-op":33,"../util":42}],44:[function(require,module,exports){var util=require("../util"),rangeUtil=require("../range-util"),capitalize=require("capitalize"),addDirtyProps=require("../add-dirty-props"),debounce=require("../debounce");module.exports=function(_grid){function getFirstClientRect(){return container&&container.getClientRects&&container.getClientRects()&&container.getClientRects()[0]||{}}function getFixed(rowOrCol){return fixed[rowOrCol+"s"]}function convertRealToVirtual(coord,rowOrCol,coordIsVirtual){var numFixed=getFixed(rowOrCol);return numFixed>coord?coord:coord+(coordIsVirtual?-1:1)*grid.cellScrollModel[rowOrCol]}function getVirtualRowColUnsafe(realCoord,rowOrCol){return convertRealToVirtual(realCoord,rowOrCol)}function getVirtualRowColClamped(viewCoord,rowOrCol){var virtualRowCol=getVirtualRowColUnsafe(viewCoord,rowOrCol);return grid.virtualPixelCellModel["clamp"+capitalize(rowOrCol)](virtualRowCol)}function getRealRowColClamped(virtualCoord,rowOrCol){var numFixed=getFixed(rowOrCol);if(numFixed>virtualCoord)return virtualCoord;var maxViewPortIndex=viewPort[rowOrCol+"s"]-1;return util.clamp(virtualCoord-grid.cellScrollModel[rowOrCol],numFixed,maxViewPortIndex,!0)}function getLengthBetweenViewCoords(startCoord,endCoord,rowOrCol,heightOrWidth,inclusive){var rowOrColCap=capitalize(rowOrCol),toVirtual=viewPort["toVirtual"+rowOrColCap],lengthFn=grid.virtualPixelCellModel[heightOrWidth],clampFn=viewPort["clamp"+rowOrColCap],pos=0,numFixed=getFixed(rowOrCol),isInNonfixedArea=endCoord>=numFixed,isInFixedArea=numFixed>startCoord,exclusiveOffset=inclusive?0:1;if(isInFixedArea){var fixedEndCoord=isInNonfixedArea?numFixed-1:endCoord-exclusiveOffset;pos+=lengthFn(startCoord,fixedEndCoord)}return isInNonfixedArea&&(pos+=lengthFn(toVirtual(isInFixedArea?numFixed:startCoord),toVirtual(clampFn(endCoord))-exclusiveOffset)),pos}function getTopOrLeft(endCoord,rowOrCol,heightOrWidth){return getLengthBetweenViewCoords(0,endCoord,rowOrCol,heightOrWidth)}function getRowOrColFromPosition(pos,rowOrCol,heightOrWidth,returnVirtual){for(var rowOrColCap=capitalize(rowOrCol),viewMax=viewPort[rowOrCol+"s"],toVirtual=viewPort["toVirtual"+rowOrColCap],lengthFn=grid.virtualPixelCellModel[heightOrWidth],summedLength=0,i=0;viewMax>i;i++){var virtual=toVirtual(i),length=lengthFn(virtual),newSum=summedLength+length;if(newSum>pos)return returnVirtual?virtual:i;summedLength=newSum}return 0/0}function intersectRowsOrCols(intersection,range,topOrLeft,rowOrCol,heightOrWidth){var numFixed=fixed[rowOrCol+"s"],fixedRange=[0,numFixed],virtualRange=[range[topOrLeft],range[heightOrWidth]],fixedIntersection=rangeUtil.intersect(fixedRange,virtualRange),scrollRange=[numFixed,viewPort[rowOrCol+"s"]-numFixed];virtualRange[0]-=grid.cellScrollModel[rowOrCol];var scrollIntersection=rangeUtil.intersect(scrollRange,virtualRange),resultRange=rangeUtil.union(fixedIntersection,scrollIntersection);return resultRange?(intersection[topOrLeft]=resultRange[0],intersection[heightOrWidth]=resultRange[1],intersection):null}function calculateMaxLengths(totalLength,lengthModel){for(var lengthMethod=lengthModel.width&&grid.virtualPixelCellModel.width||grid.virtualPixelCellModel.height,numFixed=lengthModel.numFixed(),windowLength=0,maxSize=0,fixedLength=0,windowStartIndex=numFixed,fixed=0;numFixed>fixed;fixed++)fixedLength+=lengthMethod(fixed);for(var index=numFixed;index<lengthModel.length(!0);index++){var lengthOfIindex=lengthMethod(index);for(windowLength+=lengthOfIindex;windowLength+fixedLength>totalLength&&index>windowStartIndex;)windowLength-=lengthMethod(windowStartIndex),windowStartIndex++;var windowSize=index-windowStartIndex+1;windowSize>maxSize&&(maxSize=windowSize)}return Math.min(maxSize+numFixed+1,grid.virtual[lengthModel.width?"col":"row"].count())}var container,grid=_grid,dirtyClean=require("../dirty-clean")(grid),viewPort=addDirtyProps({},["rows","cols","width","height"],[dirtyClean]);viewPort.rows=0,viewPort.cols=0,viewPort.isDirty=dirtyClean.isDirty,Object.defineProperty(viewPort,"top",{enumerable:!0,get:function(){return getFirstClientRect().top||0}}),Object.defineProperty(viewPort,"left",{enumerable:!0,get:function(){return getFirstClientRect().left||0}}),viewPort.toGridX=function(clientX){return clientX-viewPort.left},viewPort.toGridY=function(clientY){return clientY-viewPort.top};var fixed={rows:0,cols:0};viewPort.sizeToContainer=function(elem){container=elem,viewPort.width=elem.offsetWidth,viewPort.height=elem.offsetHeight,viewPort.rows=calculateMaxLengths(viewPort.height,grid.rowModel),viewPort.cols=calculateMaxLengths(viewPort.width,grid.colModel),grid.eventLoop.fire("grid-viewport-change")},viewPort._onResize=debounce(function(){viewPort._resize()},200),grid.eventLoop.bind("grid-destroy",function(){clearTimeout(viewPort._onResize.timeout),clearTimeout(shortDebouncedResize.timeout)}),viewPort._resize=function(){container&&viewPort.sizeToContainer(container)};var shortDebouncedResize=debounce(function(){viewPort._resize()},1);return viewPort.shortDebouncedResize=shortDebouncedResize,grid.eventLoop.bind("resize",window,function(){viewPort._onResize()}),grid.eventLoop.bind("grid-row-change",function(){fixed.rows=grid.rowModel.numFixed(),shortDebouncedResize()}),grid.eventLoop.bind("grid-col-change",function(){fixed.cols=grid.colModel.numFixed(),shortDebouncedResize()}),viewPort.toVirtualRow=function(r){return getVirtualRowColClamped(r,"row")},viewPort.toVirtualCol=function(c){return getVirtualRowColClamped(c,"col")},viewPort.rowIsInView=function(virtualRow){var realRow=viewPort.toRealRow(virtualRow);return!isNaN(realRow)&&getLengthBetweenViewCoords(0,realRow,"row","height",!0)<viewPort.height},viewPort.colIsInView=function(virtualCol){var realCol=viewPort.toRealCol(virtualCol);return!isNaN(realCol)&&getLengthBetweenViewCoords(0,realCol,"col","width",!0)<viewPort.width},viewPort.toRealRow=function(virtualRow){return getRealRowColClamped(virtualRow,"row")},viewPort.toRealCol=function(virtualCol){return getRealRowColClamped(virtualCol,"col")},viewPort.clampRow=function(r){return util.clamp(r,0,viewPort.rows-1)},viewPort.clampCol=function(c){return util.clamp(c,0,viewPort.cols-1)},viewPort.clampY=function(y){return util.clamp(y,0,viewPort.height)},viewPort.clampX=function(x){return util.clamp(x,0,viewPort.width)},viewPort.getRowTop=function(viewPortCoord){return getTopOrLeft(viewPortCoord,"row","height")},viewPort.getColLeft=function(viewPortCol){return getTopOrLeft(viewPortCol,"col","width")},viewPort.toPx=function(realCellRange){return{top:viewPort.getRowTop(realCellRange.top),left:viewPort.getColLeft(realCellRange.left),height:getLengthBetweenViewCoords(realCellRange.top,realCellRange.top+realCellRange.height-1,"row","height",!0),width:getLengthBetweenViewCoords(realCellRange.left,realCellRange.left+realCellRange.width-1,"col","width",!0)}},viewPort.getVirtualRowByTop=function(top){return getRowOrColFromPosition(top,"row","height",!0)},viewPort.getVirtualColByLeft=function(left){return getRowOrColFromPosition(left,"col","width",!0)},viewPort.getRowByTop=function(top){return getRowOrColFromPosition(top,"row","height")},viewPort.getColByLeft=function(left){return getRowOrColFromPosition(left,"col","width")},viewPort.getRowHeight=function(viewPortRow){return grid.virtualPixelCellModel.height(viewPort.toVirtualRow(viewPort.clampRow(viewPortRow)))},viewPort.getColWidth=function(viewPortCol){return grid.virtualPixelCellModel.width(viewPort.toVirtualCol(viewPort.clampCol(viewPortCol)))},viewPort.intersect=function(range){var intersection=intersectRowsOrCols({},range,"top","row","height");return intersection?intersectRowsOrCols(intersection,range,"left","col","width"):null},viewPort.iterateCells=function(cellFn,optionalRowFn,optionalMaxRow,optionalMaxCol){optionalMaxRow=optionalMaxRow||1/0,optionalMaxCol=optionalMaxCol||1/0;for(var r=0;r<Math.min(viewPort.rows,optionalMaxRow);r++)if(optionalRowFn&&optionalRowFn(r),cellFn)for(var c=0;c<Math.min(viewPort.cols,optionalMaxCol);c++)cellFn(r,c)},viewPort}},{"../add-dirty-props":12,"../debounce":25,"../dirty-clean":27,"../range-util":37,"../util":42,capitalize:2}],45:[function(require,module,exports){var util=require("../util");module.exports=function(_grid){function clampRowOrCol(virtualRowCol,rowOrCol){var maxRowCol=grid[rowOrCol+"Model"].length(!0)-1;return util.clamp(virtualRowCol,0,maxRowCol)}function heightOrWidth(start,end,rowOrCol){var length=0;if(start>end)return 0;end=util.isNumber(end)?end:start,end=clampRowOrCol(end,rowOrCol),start=clampRowOrCol(start,rowOrCol);for(var lengthModel=grid[rowOrCol+"Model"],lengthFn=lengthModel.width||lengthModel.height,i=start;end>=i;i++)length+=lengthFn(i);return length}function sizeChangeListener(){grid.eventLoop.fire("grid-virtual-pixel-cell-change")}var grid=_grid,model={};return model.getRow=function(topPx){if(0>topPx)return 0/0;for(var sumLength=0,r=0;r<grid.rowModel.length(!0);r++)if(sumLength+=grid.rowModel.height(r),sumLength>topPx)return r;return 0/0},model.getCol=function(leftPx){if(0>leftPx)return 0/0;for(var sumLength=0,c=0;c<grid.colModel.length(!0);c++)if(sumLength+=grid.colModel.width(c),sumLength>leftPx)return c;return 0/0},model.clampRow=function(virtualRow){return clampRowOrCol(virtualRow,"row")},model.clampCol=function(virtualCol){return clampRowOrCol(virtualCol,"col")},model.height=function(virtualRowStart,virtualRowEnd){return heightOrWidth(virtualRowStart,virtualRowEnd,"row")},model.width=function(virtualColStart,virtualColEnd){return heightOrWidth(virtualColStart,virtualColEnd,"col")},model.totalHeight=function(){return model.height(0,grid.rowModel.length(!0)-1)},model.totalWidth=function(){return model.width(0,grid.colModel.length(!0)-1)},model.fixedHeight=function(){return model.height(0,grid.rowModel.numFixed()-1)},model.fixedWidth=function(){return model.width(0,grid.colModel.numFixed()-1)},grid.eventLoop.bind("grid-col-change",sizeChangeListener),grid.eventLoop.bind("grid-row-change",sizeChangeListener),model}},{"../util":42}]},{},[1]);